{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js/BarChart.js","js/MnistData.js","js/NeuralNetwork.js","js/Paint.js","js/main-lib.js","js/neural-numbers-component.js","js/training-component.js","js/training-controller.js","js/training-viz.js","node_modules/events/events.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","BarChart","el","_classCallCheck","this","cleanup","bars","cbarcontainer","document","createElement","className","classList","add","cbartext","innerHTML","concat","appendChild","firstChild","removeChild","probabilities","highlighted","arguments","undefined","dataset","probability","style","toggle","IMAGE_SIZE","NUM_TRAIN_ELEMENTS","NUM_DATASET_ELEMENTS","MNIST_IMAGES_SPRITE_PATH","MNIST_LABELS_PATH","MnistData","imagePath","labelPath","shuffledTrainIndex","shuffledTestIndex","img","Image","canvas","ctx","getContext","willReadFrequently","imgRequest","Promise","resolve","reject","crossOrigin","onload","width","naturalWidth","height","naturalHeight","datasetBytesBuffer","ArrayBuffer","datasetBytesView","Float32Array","drawImage","imageData","getImageData","j","data","_this","datasetImages","src","labelsRequest","fetch","all","labelsResponse","Uint8Array","arrayBuffer","datasetLabels","trainIndices","tf","util","createShuffledIndices","testIndices","trainImages","slice","testImages","trainLabels","NUM_CLASSES","testLabels","batchSize","_this2","nextBatch","_this3","index","batchImagesArray","batchLabelsArray","idx","image","set","label","xs","tensor2d","labels","NeuralNetwork","options","Object","assign","trainingCallback","batchCallback","modelUpdateCallback","modelUpdateAsyncCallback","training","init","modelid","optimizerid","learningRate","activation","console","log","trainedimages","lastrainedimages","pausecbs","model","dispose","sequential","layers","conv2d","inputShape","kernelSize","filters","strides","kernelInitializer","maxPooling2d","poolSize","flatten","dense","units","optimizer","train","adam","sgd","compile","loss","metrics","TRAIN_DATA_SIZE","BATCH_SIZE","setBackend","tidy","d","nextTrainBatch","reshape","trainXs","trainYs","fit","callbacks","onEpochEnd","_onEpochEnd","_asyncToGenerator","regeneratorRuntime","mark","_callee","wrap","_context","prev","next","stop","apply","onBatchEnd","_onBatchEnd","_callee2","_context2","trainByBatchFromData","Math","min","setTimeout","pop","cb","push","addPauseCallback","pauseTraining","_BarChart","SCALE_FACTOR","LINEWIDTH","Paint","outputThreshold","nwvis","clearTimeoutTime","drawingChanged","barchart","drawingActive","clearOnInput","pos","x","y","createUI","empty","isdown","pointerId","eventname","eventfunctions","pointerdown","clear","removeClearTimeout","setPosition","pointermove","draw","pointerup","setClearTimeout","pointerleave","pointercancel","drawcanvas","addEventListener","passive","removeEventListener","querySelector","normalizecanvas","outputbars","outputdigit","inputbox","addEventListeners","updateDimensions","floor","clientWidth","window","onresize","drawcontext","normalizecontext","rect","getBoundingClientRect","clientX","left","clientY","top","clearTimeout","ox","oy","nx","ny","abs","remove","beginPath","lineWidth","lineCap","strokeStyle","moveTo","lineTo","stroke","fillStyle","fillRect","normalize","predict","SKIPFACTOR","boxsize","centerx","centery","bottom","right","totalweight","max","_tf$tidy2","predicted","_this4","_slicedToArray","imageTensor","browser","fromPixels","toFloat","mul","scalar","clipByValue","show","filter","k","result","dataSync","argMax","update","parentElement","removeEventListeners","_neuralNumbersComponent","_interopRequireDefault","_trainingController","_trainingComponent","attrFlag","attribute","defaultValue","$","each","element","props","modelPath","attr","inputPlaceholder","showBars","showNormalizer","showOutput","IMAGINARY","NeuralNumbers","NeuralNumbersTrainingController","NeuralNumbersTraining","_Paint","models","path","loadLayersModel","sent","abrupt","NeuralNumbersComponent","$element","defaultModel","paint","_this$props","safeInputPlaceholder","classes","verticalBars","addClass","toggleClass","$inputStage","appendTo","$drawCanvas","placeholderText","html","text","append","$normalizeStage","$normalizeCanvas","$probabilityStage","$bars","$outputStage","$output","loadModel","PAINT_CLEAR_TIMEOUT","swapModel","disableDrawing","enableDrawing","setClearOnInput","TrainingComponent","nnComponent","trainingController","imageCountLabelText","predictedAccuracyLabelText","$controlsL","$progress","$imageCount","$imageCountLabel","$imageCountValue","$accuracy","$accuracyLabel","$accuracyValue","$controlsR","$startPauseBtn","on","handleStartPauseBtn","bind","$stepBtn","handleStepBtn","$resetBtn","handleResetBtn","events","handleBatch","handleAccuracy","handleTrainingStart","handleTrainingPause","handleTrainingComplete","handleTrainingReset","disableButtons","enableButtons","isTraining","pause","start","step","reset","imageCount","accuracy","round","removeClass","disableTrainingButtons","enableTrainingButtons","_events","_NeuralNetwork","_trainingViz","_MnistData","TrainingController","maxTrainingImages","trainingImagePath","trainingLabelPath","nn","handleTraining","handleModelUpdate","trainingViz","load","rebuildNetwork","setModel","emit","trainSingleStep","setCurrentTraining","estimateAccuracy","TrainingViz","drawCanvas","drawCanvasCtx","trainDigitBuffer","trainX1","toPixels","active","currentDigit","computeActivations","trainY1","currentTarget","renderNetwork","renderActivations","input","A1","A2","A3","_A3$argMax$dataSync2","prediction","_prediction$argMax$da2","intermediateActivations","map","currentProbabilities","clearRect","destOrigin","destSize","clearActivations","getBarChart","testDataSize","nextTestBatch","testXs","testYs","evaluate","objectCreate","create","proto","F","prototype","objectKeys","keys","obj","hasOwnProperty","Function","context","fn","EventEmitter","_eventsCount","_maxListeners","hasDefineProperty","defaultMaxListeners","defineProperty","value","err","$getMaxListeners","that","_addListener","target","type","listener","prepend","existing","w","m","TypeError","newListener","unshift","warned","String","name","emitter","count","warn","message","onceWrapper","fired","removeListener","wrapFn","args","Array","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","unwrapListeners","arrayClone","listenerCount","copy","enumerable","get","arg","setMaxListeners","isNaN","getMaxListeners","er","handler","doError","error","len","isFn","self","listeners","emitNone","arg1","emitOne","arg2","emitTwo","arg3","emitThree","emitMany","addListener","prependListener","once","prependOnceListener","list","position","originalListener","shift","spliceOne","removeAllListeners","key","rawListeners","eventNames","Reflect","ownKeys"],"mappings":"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","file":"neural-numbers.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","export default class BarChart {\n  constructor(el) {\n    this.el = el;\n    // cleanup potentially previously existing bars\n    this.cleanup();\n\n    this.bars = [];\n    for (let i = 0; i < 10; i += 1) {\n      const cbarcontainer = document.createElement('div');\n      cbarcontainer.className = 'barcontainer';\n      this.bars[i] = document.createElement('div');\n      this.bars[i].classList.add('bar');\n      const cbartext = document.createElement('div');\n      cbartext.className = 'bartxt';\n      cbartext.innerHTML = `${i}`;\n      cbarcontainer.appendChild(this.bars[i]);\n      cbarcontainer.appendChild(cbartext);\n      this.el.appendChild(cbarcontainer);\n    }\n  }\n\n  cleanup() {\n    while (this.el.firstChild) {\n      this.el.removeChild(this.el.firstChild);\n    }\n  }\n\n  update(probabilities, highlighted = -1) {\n    for (let i = 0; i < 10; i += 1) {\n      this.bars[i].dataset.probability = probabilities[i];\n      this.bars[i].style = `--probability: ${probabilities[i]}`;\n      this.bars[i].classList.toggle('highlighted', i === highlighted);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nconst IMAGE_SIZE = 784;\nconst NUM_CLASSES = 10;\nconst NUM_DATASET_ELEMENTS = 65000;\n\nconst NUM_TRAIN_ELEMENTS = NUM_DATASET_ELEMENTS*0.8 | 0; //80% TODO make this custoumizeable\nconst NUM_TEST_ELEMENTS = NUM_DATASET_ELEMENTS - NUM_TRAIN_ELEMENTS;\n\nconst MNIST_IMAGES_SPRITE_PATH =\n    'assets/mnist/mnist_images.png';\nconst MNIST_LABELS_PATH =\n    'assets/mnist/mnist_labels_uint8';\n\n/**\n * A class that fetches the sprited MNIST dataset and returns shuffled batches.\n *\n * NOTE: This will get much easier. For now, we do data fetching and\n * manipulation manually.\n */\nexport class MnistData {\n  constructor(imagePath = MNIST_IMAGES_SPRITE_PATH, labelPath = MNIST_LABELS_PATH) {\n    this.shuffledTrainIndex = 0;\n    this.shuffledTestIndex = 0;\n    this.imagePath = imagePath;\n    this.labelPath = labelPath;\n  }\n\n  async load() {\n    // Make a request for the MNIST sprited image.\n    const img = new Image();\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d', { willReadFrequently: true });\n    const imgRequest = new Promise((resolve, reject) => {\n      img.crossOrigin = '';\n      img.onload = () => {\n        img.width = img.naturalWidth;\n        img.height = img.naturalHeight;\n\n        const datasetBytesBuffer =\n            new ArrayBuffer(NUM_DATASET_ELEMENTS * IMAGE_SIZE * 4);\n\n        const chunkSize = 5000;\n        canvas.width = img.width;\n        canvas.height = chunkSize;\n\n        for (let i = 0; i < NUM_DATASET_ELEMENTS / chunkSize; i++) {\n          const datasetBytesView = new Float32Array(\n              datasetBytesBuffer, i * IMAGE_SIZE * chunkSize * 4,\n              IMAGE_SIZE * chunkSize);\n          ctx.drawImage(\n              img, 0, i * chunkSize, img.width, chunkSize, 0, 0, img.width,\n              chunkSize);\n\n          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n          for (let j = 0; j < imageData.data.length / 4; j++) {\n            // All channels hold an equal value since the image is grayscale, so\n            // just read the red channel.\n            datasetBytesView[j] = imageData.data[j * 4] / 255;\n          }\n        }\n        this.datasetImages = new Float32Array(datasetBytesBuffer);\n\n        resolve();\n      };\n      img.src = this.imagePath;\n    });\n\n    const labelsRequest = fetch(this.labelPath);\n    const [imgResponse, labelsResponse] =\n        await Promise.all([imgRequest, labelsRequest]);\n\n    this.datasetLabels = new Uint8Array(await labelsResponse.arrayBuffer());\n    // Create shuffled indices into the train/test set for when we select a\n    // random dataset element for training / validation.\n    this.trainIndices = tf.util.createShuffledIndices(NUM_TRAIN_ELEMENTS);\n    this.testIndices = tf.util.createShuffledIndices(NUM_TEST_ELEMENTS);\n\n    // Slice the the images and labels into train and test sets.\n    this.trainImages =\n        this.datasetImages.slice(0, IMAGE_SIZE * NUM_TRAIN_ELEMENTS);\n    this.testImages = this.datasetImages.slice(IMAGE_SIZE * NUM_TRAIN_ELEMENTS);\n    this.trainLabels =\n        this.datasetLabels.slice(0, NUM_CLASSES * NUM_TRAIN_ELEMENTS);\n    this.testLabels =\n        this.datasetLabels.slice(NUM_CLASSES * NUM_TRAIN_ELEMENTS);\n  }\n\n  nextTrainBatch(batchSize) {\n    return this.nextBatch(\n        batchSize, [this.trainImages, this.trainLabels], () => {\n          this.shuffledTrainIndex =\n              (this.shuffledTrainIndex + 1) % this.trainIndices.length;\n          return this.trainIndices[this.shuffledTrainIndex];\n        });\n  }\n\n  nextTestBatch(batchSize) {\n    return this.nextBatch(batchSize, [this.testImages, this.testLabels], () => {\n      this.shuffledTestIndex =\n          (this.shuffledTestIndex + 1) % this.testIndices.length;\n      return this.testIndices[this.shuffledTestIndex];\n    });\n  }\n\n  nextBatch(batchSize, data, index) {\n    const batchImagesArray = new Float32Array(batchSize * IMAGE_SIZE);\n    const batchLabelsArray = new Uint8Array(batchSize * NUM_CLASSES);\n\n    for (let i = 0; i < batchSize; i++) {\n      const idx = index();\n\n      const image =\n          data[0].slice(idx * IMAGE_SIZE, idx * IMAGE_SIZE + IMAGE_SIZE);\n      batchImagesArray.set(image, i * IMAGE_SIZE);\n\n      const label =\n          data[1].slice(idx * NUM_CLASSES, idx * NUM_CLASSES + NUM_CLASSES);\n      batchLabelsArray.set(label, i * NUM_CLASSES);\n    }\n\n    const xs = tf.tensor2d(batchImagesArray, [batchSize, IMAGE_SIZE]);\n    const labels = tf.tensor2d(batchLabelsArray, [batchSize, NUM_CLASSES]);\n\n    return {xs, labels};\n  }\n}\n","/* eslint-disable no-await-in-loop */\n/* jshint esversion: 8 */\n/* globals tf */\n\nexport default class NeuralNetwork {\n  constructor(options) {\n    this.options = Object.assign({}, {\n      trainingCallback: null,\n      batchCallback: null,\n      modelUpdateCallback: null,\n      modelUpdateAsyncCallback: null,\n    }, options);\n    this.training = false;\n    this.init();\n  }\n\n  init(modelid = 'dense', optimizerid = 'adam', learningRate = 0.001, activation = 'relu') {\n    // eslint-disable-next-line no-console\n    console.log(`Setting up NN model=${modelid} optimizer=${optimizerid} learningrate=${learningRate} activation=${activation}`);\n    this.modelid = modelid;\n    this.trainedimages = 0;\n    this.lastrainedimages = 0;\n    this.pausecbs = [];\n\n    if (this.options.batchCallback) {\n      this.options.batchCallback(this.trainedimages);\n    }\n\n    // delete old model if it has been existing\n    if (this.model) {\n      this.model.dispose();\n    }\n\n    // create model\n    this.model = tf.sequential();\n    const { model } = this;\n\n    const IMAGE_WIDTH = 28;\n    const IMAGE_HEIGHT = 28;\n    const IMAGE_CHANNELS = 1;\n\n    if (modelid === 'cnn') {\n      // CNN\n      // In the first layer of our convolutional neural network we have\n      // to specify the input shape. Then we specify some parameters for\n      // the convolution operation that takes place in this layer.\n      model.add(tf.layers.conv2d({\n        inputShape: [IMAGE_WIDTH, IMAGE_HEIGHT, IMAGE_CHANNELS],\n        kernelSize: 5,\n        filters: 8,\n        strides: 1,\n        activation,\n        kernelInitializer: 'varianceScaling',\n      }));\n\n      // The MaxPooling layer acts as a sort of downsampling using max values\n      // in a region instead of averaging.\n      model.add(tf.layers.maxPooling2d({\n        poolSize: [2, 2],\n        strides: [2, 2],\n      }));\n\n      // Repeat another conv2d + maxPooling stack.\n      // Note that we have more filters in the convolution.\n      model.add(tf.layers.conv2d({\n        kernelSize: 5,\n        filters: 16,\n        strides: 1,\n        activation,\n        kernelInitializer: 'varianceScaling',\n      }));\n      model.add(tf.layers.maxPooling2d({\n        poolSize: [2, 2],\n        strides: [2, 2],\n      }));\n\n      // Now we flatten the output from the 2D filters into a 1D vector to prepare\n      // it for input into our last layer. This is common practice when feeding\n      // higher dimensional data to a final classification output layer.\n      model.add(tf.layers.flatten());\n    } else if (modelid === 'dense') {\n      model.add(\n        tf.layers.flatten({\n          inputShape: [IMAGE_WIDTH, IMAGE_HEIGHT, IMAGE_CHANNELS],\n        })\n      );\n\n      model.add(tf.layers.dense({\n        units: 100,\n        activation,\n        kernelInitializer: 'varianceScaling',\n      }));\n    } else if (modelid === 'nohidden') {\n      model.add(\n        tf.layers.flatten({\n          inputShape: [IMAGE_WIDTH, IMAGE_HEIGHT, IMAGE_CHANNELS],\n        })\n      );\n    }\n\n    // Our last layer is a dense layer which has 10 output units, one for each\n    // output class (i.e. 0, 1, 2, 3, 4, 5, 6, 7, 8, 9).\n    const NUM_OUTPUT_CLASSES = 10;\n    model.add(tf.layers.dense({\n      units: NUM_OUTPUT_CLASSES,\n      kernelInitializer: 'varianceScaling',\n      activation: 'softmax',\n    }));\n\n    // Choose an optimizer, loss function and accuracy metric,\n    // then compile and return the model\n    const optimizer = (optimizerid === 'adam') ? tf.train.adam(learningRate) : tf.train.sgd(learningRate);\n    // tf.train.adam(learningRate);\n\n    model.compile({\n      optimizer,\n      loss: 'categoricalCrossentropy',\n      // optimizer: 'sgd',\n      // loss: 'meanSquaredError',\n      metrics: ['accuracy'],\n    });\n\n    return model;\n  }\n\n  async trainByBatchFromData(data, TRAIN_DATA_SIZE, BATCH_SIZE) {\n    if (TRAIN_DATA_SIZE === 1 || BATCH_SIZE === 1) {\n      tf.setBackend('cpu');\n      // fitting with single training-data results in NaNs when WebGL-backend is used\n      // for unknown reasons. Unfortunately, mixing cpu ang webgl backend changes the\n      // training in some way: Way more input images are required to obtain same accuracy\n    }\n    const { model } = this;\n    const [trainXs, trainYs] = tf.tidy(() => {\n      const d = data.nextTrainBatch(TRAIN_DATA_SIZE);\n      return [\n        d.xs.reshape([TRAIN_DATA_SIZE, 28, 28, 1]),\n        d.labels,\n      ];\n    });\n\n    if (this.options.trainingCallback) {\n      await this.options.trainingCallback(trainXs, trainYs);\n    }\n\n    await model.fit(trainXs, trainYs, {\n      batchSize: BATCH_SIZE,\n      callbacks: {\n        onEpochEnd: async () => {},\n        onBatchEnd: async () => {\n          this.trainedimages += BATCH_SIZE;\n          if (this.options.batchCallback) {\n            this.options.batchCallback(this.trainedimages);\n          }\n        },\n      },\n    });\n    tf.dispose(trainXs);\n    tf.dispose(trainYs);\n\n    if (TRAIN_DATA_SIZE === 1 || BATCH_SIZE === 1) {\n      tf.setBackend('webgl');\n      // fitting with single training-data results in NaNs when WebGL-backend\n      // is used for unknown reasons\n    }\n  }\n\n  async trainSingleStep(data) {\n    await this.trainByBatchFromData(data, 1, 1);\n    if (this.options.modelUpdateCallback) {\n      this.options.modelUpdateCallback(this.model);\n    }\n    if (this.options.modelUpdateAsyncCallback) {\n      await this.options.modelUpdateAsyncCallback(this.model);\n    }\n  }\n\n  async train(data) {\n    this.training = true;\n\n    while (this.training) {\n      // start slower in beginning, increase step size with time\n      // const BATCH_SIZE = 1 << (Math.max(4, Math.min(8, this.trainedimages / 20 | 0)));\n      // a sequence of increasing powers of two\n\n      // a constant BATCH_SIZE and TRAIN_DATA_SIZE increases the speed of convergence :/.\n      const BATCH_SIZE = 32;\n      const TRAIN_DATA_SIZE = 32; // *Math.min(8, Math.max(1, this.trainedimages / 40 | 0));\n\n      await this.trainByBatchFromData(data, BATCH_SIZE, TRAIN_DATA_SIZE);\n\n      if (this.trainedimages\n        > this.lastrainedimages + Math.min(1000, 0.3 * this.trainedimages)\n        || this.trainedimages < 250) {\n        if (this.options.modelUpdateCallback) {\n          this.options.modelUpdateCallback(this.model);\n        }\n        if (this.options.modelUpdateAsyncCallback) {\n          await this.options.modelUpdateAsyncCallback(this.model);\n        }\n        if ((this.trainedimages < 100)) {\n          // sleep some time per image\n          await new Promise(resolve => setTimeout(\n            resolve,\n            (1000 / (5 + 4 * this.trainedimages)) * (this.trainedimages - this.lastrainedimages)\n          ));\n        }\n        this.lastrainedimages = this.trainedimages;\n      }\n    }\n\n    while (this.pausecbs.length > 0) {\n      (this.pausecbs.pop())();\n    }\n  }\n\n  addPauseCallback(cb) {\n    this.pausecbs.push(cb);\n  }\n\n  pauseTraining() {\n    return new Promise((resolve) => {\n      if (this.training) {\n        this.addPauseCallback(resolve);\n        this.training = false;\n      } else {\n        resolve();\n      }\n    });\n  }\n\n  isTraining() {\n    return this.training;\n  }\n\n  async toggleTraining(data) {\n    if (this.training) {\n      await this.pauseTraining();\n    } else {\n      await this.train(data);\n    }\n  }\n\n  cleanup() {\n    this.model.dispose();\n    this.trainedimages = 0;\n    this.lastrainedimages = 0;\n  }\n}\n","/* globals tf */\n/* eslint-disable no-bitwise */\nimport BarChart from './BarChart.js';\n\nlet SCALE_FACTOR = 9;\nlet LINEWIDTH = 2 * SCALE_FACTOR;\n\nexport default class Paint {\n  constructor(el, model, outputThreshold, nwvis = false, clearTimeoutTime = 2.2) {\n    this.clearTimeoutTime = clearTimeoutTime;\n    this.drawingChanged = true;\n    this.model = model;\n    this.nwvis = nwvis;\n    this.barchart = null;\n    this.drawingActive = true;\n    this.clearOnInput = false;\n\n    this.outputThreshold = outputThreshold;\n\n    // last known position\n    this.pos = {\n      x: 0,\n      y: 0,\n    };\n\n    this.createUI(el);\n    this.empty = true;\n    this.isdown = false;\n    this.pointerId = -1;\n  }\n\n  addEventListeners() {\n    this.eventfunctions = {\n      pointerdown: ((e) => {\n        if (!this.isdown && this.drawingActive) {\n          if (this.clearOnInput) {\n            this.clear();\n          }\n          this.removeClearTimeout();\n          this.setPosition(e);\n          this.isdown = true;\n          this.pointerId = e.pointerId;\n        }\n      }),\n      pointermove: ((e) => {\n        if (this.isdown && this.drawingActive && (this.pointerId === e.pointerId)) {\n          this.draw(e);\n        }\n      }),\n      pointerup: ((e) => {\n        if (this.drawingActive && (this.pointerId === e.pointerId)) {\n          this.setClearTimeout();\n          this.isdown = false;\n        }\n      }),\n      pointerleave: ((e) => {\n        if (this.drawingActive && (this.pointerId === e.pointerId)) {\n          this.setClearTimeout();\n          this.isdown = false;\n        }\n      }),\n      pointercancel: ((e) => {\n        if (this.drawingActive && (this.pointerId === e.pointerId)) {\n          this.setClearTimeout();\n          this.isdown = false;\n        }\n      }),\n    };\n\n    for (const eventname in this.eventfunctions) {\n      this.drawcanvas.addEventListener(eventname, this.eventfunctions[eventname], {\n        passive: true,\n      });\n    }\n  }\n\n  removeEventListeners() {\n    for (const eventname in this.eventfunctions) {\n      this.drawcanvas.removeEventListener(eventname, this.eventfunctions[eventname]);\n    }\n  }\n\n  createUI(el) {\n    this.drawcanvas = el.querySelector('.drawcanvas');\n    this.normalizecanvas = el.querySelector('.normalizecanvas') || document.createElement('canvas');\n    this.outputbars = el.querySelector('.bars');\n    this.outputdigit = el.querySelector('.digit');\n    this.inputbox = el.querySelector('.input.box');\n\n    this.addEventListeners();\n\n    const { normalizecanvas, drawcanvas } = this;\n\n    normalizecanvas.width = 28;\n    normalizecanvas.height = 28;\n\n    const updateDimensions = () => {\n      SCALE_FACTOR = Math.floor(this.drawcanvas.clientWidth / 28) - 1;\n      LINEWIDTH = 2 * SCALE_FACTOR;\n      drawcanvas.width = this.drawcanvas.clientWidth;\n      drawcanvas.height = this.drawcanvas.clientWidth;\n    };\n    updateDimensions();\n    window.onresize = () => {\n      updateDimensions();\n    };\n\n    this.drawcontext = this.drawcanvas.getContext('2d', { willReadFrequently: true });\n    this.normalizecontext = this.normalizecanvas.getContext('2d', { willReadFrequently: true });\n    // const { drawcontext, normalizecontext } = this;\n    //  normalizecanvas.style.width = 28 * SCALE_FACTOR + 'px';\n    //  normalizecanvas.style.height = 28 * SCALE_FACTOR + 'px';\n    //  normalizecanvas.style.imageRendering = 'pixelated';\n    /*\n        const resetbutton = document.createElement(\"button\");\n        this.resetbutton = resetbutton;\n        this.resetbutton.style.visibility = 'hidden';\n\n        resetbutton.innerHTML = \"reset\";\n        resetbutton.addEventListener('click', () => {\n          this.drawcontext.fillRect(0, 0, this.drawcanvas.width, this.drawcanvas.height);\n          this.normalize(100);\n          this.predict();\n          this.resetbutton.style.visibility = 'hidden';\n        });\n\n        this.drawcanvas.parentNode.insertBefore(resetbutton, this.drawcanvas);\n        this.resetbutton.style.position = \"absolute\";\n        this.resetbutton.style.zIndex = 10;\n    */\n    if (this.outputbars) {\n      this.barchart = new BarChart(this.outputbars);\n    }\n\n    this.clear();\n  }\n\n\n  setPosition(e) {\n    const rect = this.drawcanvas.getBoundingClientRect();\n    this.pos.x = (e.clientX - rect.left);\n    this.pos.y = (e.clientY - rect.top);\n    return true;\n  }\n\n  removeClearTimeout() {\n    if (this.clearTimeout) {\n      clearTimeout(this.clearTimeout);\n    }\n    return true;\n  }\n\n  setClearTimeout() {\n    this.removeClearTimeout(); // remove previous clearTimeouts\n    // clean up everything after specified time\n    this.clearTimeout = setTimeout(() => {\n      this.clear();\n    }, this.clearTimeoutTime * 1000);\n    return true;\n  }\n\n  setClearOnInput() {\n    this.clearOnInput = true;\n  }\n\n  draw(e) {\n    this.removeClearTimeout();\n    const ox = this.pos.x;\n    const oy = this.pos.y;\n    this.setPosition(e);\n    const nx = this.pos.x;\n    const ny = this.pos.y;\n    if (Math.abs(nx - ox) + Math.abs(ny - oy) < 3) {\n      this.pos.x = ox;\n      this.pos.y = oy;\n      return;\n    }\n    this.inputbox.classList.remove('background');\n    this.empty = false;\n    this.drawcontext.beginPath(); // begin\n    this.drawcontext.lineWidth = LINEWIDTH;\n    this.drawcontext.lineCap = 'round';\n    this.drawcontext.strokeStyle = 'white';\n\n    this.drawcontext.moveTo(ox, oy); // from\n    this.setPosition(e);\n    this.drawcontext.lineTo(nx, ny); // to\n\n    this.drawcontext.stroke(); // draw it!\n\n    this.normalizecontext.fillStyle = 'black';\n    this.normalizecontext.fillRect(0, 0, this.normalizecanvas.width, this.normalizecanvas.height);\n\n    this.drawingChanged = true;\n    this.normalize(LINEWIDTH);\n    this.predict();\n    // this.resetbutton.style.visibility = 'visible';\n  }\n\n  // normalize image\n  normalize(SKIPFACTOR) {\n    let centerx = 0;\n    let centery = 0;\n    let top = 1000;\n    let bottom = -1000;\n    let left = 1000;\n    let right = -1000;\n    const imgData = this.drawcontext.getImageData(\n      0, 0, this.drawcanvas.width, this.drawcanvas.height\n    );\n    const { data } = imgData;\n    let totalweight = 0;\n    for (let i = 0; i < data.length; i += 4 * SKIPFACTOR) {\n      const x = (i / 4) % this.drawcanvas.width;\n      const y = ((i / 4) / (this.drawcanvas.width)) | 0;\n      totalweight += data[i];\n      centerx += (data[i]) * x;\n      centery += (data[i]) * y;\n\n      if (data[i] > 0) {\n        top = Math.min(top, y);\n        bottom = Math.max(bottom, y);\n        left = Math.min(left, x);\n        right = Math.max(right, x);\n      }\n    }\n    if (totalweight > 0) {\n      centerx /= totalweight;\n      centery /= totalweight;\n\n      const boxsize = Math.max(right - left, bottom - top);\n\n      // according to MNIST normalization:\n      /*\n      The original black and white (bilevel) images from NIST were size normalized\n      to fit in a 20x20 pixel box while preserving their aspect ratio. The\n      resulting images contain grey levels as a result of the anti-aliasing\n      technique used by the normalization algorithm. the images were centered\n      in a 28x28 image by computing the center of mass of the pixels, and\n      translating the image so as to position this point at the center of the 28x28 field.\n      */\n      this.normalizecontext.drawImage(\n        this.drawcanvas,\n        left, top,\n        boxsize, boxsize,\n        14 + (20 / boxsize) * (left - centerx),\n        14 + (20 / boxsize) * (top - centery),\n        20, 20\n      );\n    } else {\n      this.normalizecontext.fillRect(0, 0, this.normalizecanvas.width, this.normalizecanvas.height);\n    }\n\n    return true;\n  }\n\n  predict() {\n    if (this.model && this.normalizecanvas && this.drawingChanged) { // && newFrame rendered TODO?\n      const [probabilities, predicted] = tf.tidy(() => {\n        const imageTensor = tf.browser\n          .fromPixels(this.normalizecanvas, 1)\n          .toFloat()\n          .mul(tf.scalar(1 / 255))\n          .clipByValue(0, 1)\n          .reshape([1, 28, 28, 1]);\n        if (this.nwvis) {\n          this.nwvis.show(imageTensor,\n            this.normalizecontext.getImageData(\n              0, 0,\n              this.normalizecanvas.width, this.normalizecanvas.height\n            ).data.filter((d, k) => (k % 4 === 0)));\n        }\n        const result = this.model.predict(imageTensor);\n        return [\n          result.dataSync(),\n          result.argMax([-1]).dataSync(),\n        ];\n      });\n\n      if (this.barchart) {\n        this.barchart.update(probabilities, predicted);\n      }\n\n      if (this.outputdigit) {\n        this.outputdigit.innerHTML = (!this.empty && probabilities[predicted] > this.outputThreshold) ? predicted : '?';\n        this.outputdigit.parentElement.classList.toggle('solved', probabilities[predicted] > this.outputThreshold);\n      }\n    }\n    return true;\n  }\n\n  swapModel(model) {\n    this.model = model;\n    this.predict();\n  }\n\n  clear() {\n    this.clearOnInput = false;\n    this.drawcontext.fillRect(0, 0, this.drawcanvas.width, this.drawcanvas.height);\n    this.empty = true;\n    this.normalize(100);\n    this.predict();\n    this.inputbox.classList.add('background');\n  }\n\n  cleanup() {\n    this.clear();\n    this.removeEventListeners();\n\n    // this.predict();\n    // this.resetbutton.style.visibility = 'hidden';\n\n    if (this.barchart) {\n      this.barchart.cleanup();\n    }\n  }\n\n  disableDrawing() {\n    this.drawingActive = false;\n    this.isdown = false;\n  }\n\n  enableDrawing() {\n    this.drawingActive = true;\n  }\n}\n","import NeuralNumbersComponent from './neural-numbers-component';\nimport TrainingController from './training-controller';\nimport TrainingComponent from \"./training-component\";\n\nfunction attrFlag(attribute, defaultValue) {\n  if (attribute === undefined) {\n    return defaultValue;\n  }\n  return attribute !== 'false';\n}\n\n$('[data-component=neural-numbers]')\n  .each((i, element) => {\n    const props = {\n      modelPath: $(element).attr('data-model') || null,\n      inputPlaceholder: $(element).attr('data-input-placeholder') || '',\n      showBars: attrFlag($(element).attr('data-show-bars'), false),\n      showNormalizer: attrFlag($(element).attr('data-show-normalizer'), false),\n      showOutput: attrFlag($(element).attr('data-show-output'), true),\n    };\n    const component = new NeuralNumbersComponent(element, props);\n    component.init();\n  });\n\nif (window.IMAGINARY === undefined) {\n  window.IMAGINARY = {};\n}\n\nif (window.IMAGINARY.NeuralNumbers === undefined) {\n  window.IMAGINARY.NeuralNumbers = NeuralNumbersComponent;\n  window.IMAGINARY.NeuralNumbersTrainingController = TrainingController;\n  window.IMAGINARY.NeuralNumbersTraining = TrainingComponent;\n}\n","/* globals tf */\n\nimport Paint from './Paint';\n\nconst models = {};\n\nasync function loadModel(path) {\n  if (path && !(path in models)) {\n    models[path] = await tf.loadLayersModel(path);\n  }\n  return models[path];\n}\n\nexport default class NeuralNumbersComponent {\n  constructor(element, props) {\n    this.$element = $(element);\n    this.props = props;\n    this.defaultModel = null;\n    this.model = null;\n    this.paint = null;\n\n    const {\n      inputPlaceholder,\n      safeInputPlaceholder,\n      classes,\n      showBars,\n      showNormalizer,\n      showOutput,\n      verticalBars\n    } = this.props;\n\n    this.$element.addClass('neural-numbers-component');\n    this.$element.toggleClass('with-bars', showBars);\n    this.$element.toggleClass('with-normalizer', showNormalizer);\n    this.$element.toggleClass('with-output', showOutput);\n    if (classes) {\n      this.$element.addClass(classes);\n    }\n\n    this.$inputStage = $('<div>')\n      .addClass(['stage', 'stage-input', 'input', 'box'])\n      .appendTo(this.$element);\n\n    this.$drawCanvas = $('<canvas>')\n      .addClass(['drawcanvas', 'input-canvas'])\n      .appendTo(\n        $('<div>')\n          .addClass('input-canvas-wrapper')\n          .appendTo(this.$inputStage)\n      );\n\n    const placeholderText = $('<span>');\n    if (inputPlaceholder) {\n      placeholderText.html(inputPlaceholder);\n    } else if (safeInputPlaceholder) {\n      placeholderText.text(safeInputPlaceholder);\n    }\n    $('<div>')\n        .addClass('input-placeholder')\n        .append(placeholderText)\n        .appendTo(this.$inputStage);\n\n    this.$normalizeStage = $('<div>')\n      .addClass(['stage', 'stage-normalize'])\n      .appendTo(this.$element);\n\n    this.$normalizeCanvas = $('<canvas>')\n      .addClass('normalizecanvas')\n      .appendTo($('<div>')\n        .addClass('normalize-canvas-wrapper')\n        .appendTo(this.$normalizeStage));\n\n    this.$probabilityStage = $('<div>')\n      .addClass(['stage', 'stage-bars'])\n      .appendTo(this.$element);\n\n    this.$bars = $('<div>')\n      .addClass('bars')\n      .toggleClass('bars-vertical', verticalBars || false)\n      .appendTo(this.$probabilityStage);\n\n    this.$outputStage = $('<div>')\n      .addClass(['stage', 'stage-output'])\n      .appendTo(this.$element);\n\n    this.$output = $('<div>')\n      .addClass(['output', 'digit'])\n      .appendTo($('<div>')\n        .addClass('output-wrapper')\n        .appendTo(this.$outputStage));\n  }\n\n  async init() {\n    const { modelPath } = this.props;\n    this.defaultModel = await loadModel(modelPath);\n    this.model = this.defaultModel;\n\n    this.paint = new Paint(\n      this.$element[0],\n      this.model,\n      0.5,\n      false,\n      NeuralNumbersComponent.PAINT_CLEAR_TIMEOUT);\n  }\n\n  setModel(model = null) {\n    if (model === null) {\n      model = this.defaultModel;\n    }\n    this.model = model;\n    this.paint.swapModel(model);\n  }\n\n  getBarChart() {\n    return this.paint.barchart;\n  }\n\n  disableDrawing() {\n    this.paint.disableDrawing();\n  }\n\n  enableDrawing() {\n    this.paint.enableDrawing();\n  }\n\n  setClearTimeout() {\n    this.paint.setClearTimeout();\n  }\n\n  setClearOnInput() {\n    this.paint.setClearOnInput();\n  }\n}\n\nNeuralNumbersComponent.PAINT_CLEAR_TIMEOUT = 2.2;\n","import TrainingController from \"./training-controller\";\n\nexport default class TrainingComponent {\n    constructor(nnComponent, element, props = {}) {\n        this.trainingController = new TrainingController(nnComponent, props);\n        this.nnComponent = nnComponent;\n        this.$element = $(element);\n        this.props = Object.assign({}, {\n            imageCountLabelText: 'Images used:',\n            predictedAccuracyLabelText: 'Predicted accuracy:',\n        }, props);\n\n        this.$element.addClass('neural-numbers-training-component');\n\n        this.$controlsL = $('<div>')\n            .addClass(['controls', 'controls-l'])\n            .appendTo(this.$element);\n\n        this.$progress = $('<div>')\n            .addClass('progress')\n            .appendTo(this.$element);\n\n        this.$imageCount = $('<div>')\n            .addClass('image-count')\n            .appendTo(this.$progress);\n\n        this.$imageCountLabel = $('<div>')\n            .addClass('image-count-label')\n            .html(this.props.imageCountLabelText)\n            .appendTo(this.$imageCount);\n\n        this.$imageCountValue = $('<div>')\n            .addClass('image-count-value')\n            .appendTo(this.$imageCount);\n\n        this.$accuracy = $('<div>')\n            .addClass('accuracy')\n            .appendTo(this.$progress);\n\n        this.$accuracyLabel = $('<div>')\n            .addClass('accuracy-label')\n            .html(this.props.predictedAccuracyLabelText)\n            .appendTo(this.$accuracy);\n\n        this.$accuracyValue = $('<div>')\n            .addClass('accuracy-value')\n            .appendTo(this.$accuracy);\n\n        this.$controlsR = $('<div>')\n            .addClass(['controls', 'controls-r'])\n            .appendTo(this.$element);\n\n        this.$startPauseBtn = $('<button>')\n            .addClass(['start-pause-btn', 'btn'])\n            .text('Start')\n            .on('click', this.handleStartPauseBtn.bind(this))\n            .appendTo(this.$controlsL);\n\n        this.$stepBtn = $('<button>')\n            .addClass(['step-btn', 'btn'])\n            .text('Step')\n            .on('click', this.handleStepBtn.bind(this))\n            .appendTo(this.$controlsL);\n\n        this.$resetBtn = $('<button>')\n            .addClass(['reset-btn', 'btn'])\n            .text('Reset')\n            .on('click', this.handleResetBtn.bind(this))\n            .appendTo(this.$controlsR);\n\n        this.trainingController.events.on('batch', this.handleBatch.bind(this));\n        this.trainingController.events.on('accuracy', this.handleAccuracy.bind(this));\n        this.trainingController.events.on('start', this.handleTrainingStart.bind(this));\n        this.trainingController.events.on('pause', this.handleTrainingPause.bind(this));\n        this.trainingController.events.on('training-complete', this.handleTrainingComplete.bind(this));\n        this.trainingController.events.on('reset', this.handleTrainingReset.bind(this));\n\n        this.disableButtons();\n    }\n\n    async init() {\n        await this.trainingController.init();\n        this.enableButtons();\n    }\n\n    disableButtons() {\n        this.$startPauseBtn.attr('disabled', true);\n        this.$stepBtn.attr('disabled', true);\n        this.$resetBtn.attr('disabled', true);\n    }\n\n    enableButtons() {\n        this.$startPauseBtn.attr('disabled', false);\n        this.$stepBtn.attr('disabled', false);\n        this.$resetBtn.attr('disabled', false);\n    }\n\n    disableTrainingButtons() {\n        this.$startPauseBtn.attr('disabled', true);\n        this.$stepBtn.attr('disabled', true);\n    }\n\n    enableTrainingButtons() {\n        this.$startPauseBtn.attr('disabled', false);\n        this.$stepBtn.attr('disabled', false);\n    }\n\n    handleStartPauseBtn() {\n        if (this.trainingController.isTraining()) {\n            this.trainingController.pause();\n        } else {\n            this.trainingController.start();\n        }\n    }\n\n    handleStepBtn() {\n        this.trainingController.step();\n    }\n\n    handleResetBtn() {\n        this.trainingController.reset();\n    }\n\n    handleBatch(imageCount) {\n        this.$imageCountValue.text(imageCount);\n    }\n\n    handleAccuracy(accuracy) {\n        this.$accuracyValue.attr('data-ranking', accuracy > 50 ? accuracy > 85 ? 'good' : 'mediocre' : 'bad');\n        this.$accuracyValue.text(`${Math.round(accuracy)}%`);\n    }\n\n    handleTrainingStart() {\n        this.$startPauseBtn.text('Pause');\n        this.$element.addClass('running');\n        this.nnComponent.disableDrawing();\n    }\n\n    handleTrainingPause() {\n        this.$startPauseBtn.text('Start');\n        this.$element.removeClass('running');\n        this.nnComponent.enableDrawing();\n    }\n\n    handleTrainingComplete() {\n        this.disableTrainingButtons();\n    }\n\n    handleTrainingReset() {\n        this.enableTrainingButtons();\n    }\n}\n","import EventEmitter from 'events';\nimport NeuralNetwork from './NeuralNetwork';\nimport TrainingViz from \"./training-viz\";\nimport { MnistData } from './MnistData';\n\n/**\n * A class to make a Neural Numbers component trainable.\n */\nexport default class TrainingController {\n  /**\n   * Constructor\n   *\n   * @param {NeuralNumbersComponent} nnComponent\n   *  A Neural Numbers component.\n   */\n  constructor(nnComponent, props) {\n    this.events = new EventEmitter();\n    this.nnComponent = nnComponent;\n\n    this.props = Object.assign({}, {\n      maxTrainingImages: 60000,\n      trainingImagePath: undefined,\n      trainingLabelPath: undefined,\n    }, props);\n\n    this.nn = new NeuralNetwork({\n      trainingCallback: this.handleTraining.bind(this),\n      batchCallback: this.handleBatch.bind(this),\n      modelUpdateAsyncCallback: this.handleModelUpdate.bind(this),\n    });\n    this.data = new MnistData(\n      this.props.trainingImagePath,\n      this.props.trainingLabelPath,\n    );\n    this.trainingViz = new TrainingViz(this);\n  }\n\n  /**\n   * Initialize the controller.\n   *\n   * Call this method before using the controller.\n   * @returns {Promise<void>}\n   */\n  async init() {\n    await this.data.load();\n    this.rebuildNetwork();\n  }\n\n  /**\n   * Resets the network to its untrained state.\n   * @protected\n   */\n  rebuildNetwork() {\n    this.nn.init();\n    this.nnComponent.setModel(this.nn.model);\n    this.handleModelUpdate(this.nn.model);\n    /**\n     * Emitted when the network is reset.\n     *\n     * @event TrainingController.events#reset\n     */\n    this.events.emit('reset');\n  }\n\n  /**\n   * Connects the Neural Numbers component to its original fully trained model.\n   */\n  useDefaultModel() {\n    this.nnComponent.setModel();\n    this.handleModelUpdate(this.nn.model);\n  }\n\n  /**\n   * Connects the Neural Numbers component to a new trainable model.\n   */\n  useTrainableModel() {\n    this.rebuildNetwork();\n  }\n\n  /**\n   * Returns whether the network is currently training.\n   * @returns {boolean}\n   */\n  isTraining() {\n    return this.nn.isTraining();\n  }\n\n  /**\n   * Starts training the network.\n   *\n   * @returns {Promise<void>}\n   * @fires TrainingController.events#start\n   * @fires TrainingController.events#batch\n   * @fires TrainingController.events#accuracy\n   */\n  async start() {\n    if (this.nn.trainedimages >= this.props.maxTrainingImages) {\n      return;\n    }\n    /**\n     * Emitted when training starts.\n     *\n     * @event TrainingController.events#start\n     */\n    this.events.emit('start');\n    await this.nn.train(this.data);\n  }\n\n  /**\n   * Pauses training the network.\n   *\n   * @returns {Promise<void>}\n   * @fires TrainingController.events#pause\n   */\n  async pause() {\n    await this.nn.pauseTraining();\n    /**\n     * Emitted when training pauses.\n     *\n     * @event TrainingController.events#pause\n     */\n    this.events.emit('pause');\n  }\n\n  /**\n   * Trains the network for a single step.\n   *\n   * @returns {Promise<void>}\n   * @fires TrainingController.events#batch\n   * @fires TrainingController.events#accuracy\n   */\n  async step() {\n    if (this.nn.trainedimages >= this.props.maxTrainingImages) {\n      return;\n    }\n    await this.nn.trainSingleStep(this.data);\n  }\n\n  /**\n   * Resets the network to its untrained state.\n   *\n   * @returns {Promise<void>}\n   */\n  async reset() {\n    await this.nn.pauseTraining();\n    this.rebuildNetwork();\n  }\n\n  /**\n   * Handles a batch of training images.\n   * @private\n   * @type {number}\n   * @param {number} imageCount\n   *  The number of images in the batch.\n   */\n  handleBatch(imageCount) {\n    /**\n     * Emitted when a batch of training images is processed.\n     *\n     * @event TrainingController.events#batch\n     * @type {number}\n     * @property {number} imageCount\n     *  The number of images in the batch.\n     */\n    this.events.emit('batch', imageCount);\n    if (imageCount >= this.props.maxTrainingImages) {\n      /**\n       * Emitted when training is complete.\n       *\n       * @event TrainingController.events#training-complete\n       */\n      this.events.emit('training-complete');\n      this.pause();\n    }\n  }\n\n  /**\n   * Handles a training step.\n   * @private\n   * @param trainXs\n   * @param trainYs\n   * @returns {Promise<void>}\n   */\n  async handleTraining(trainXs, trainYs) {\n    await this.trainingViz.setCurrentTraining(trainXs, trainYs);\n  }\n\n  /**\n   * Handles a model update.\n   * @private\n   * @param model\n   * @returns {Promise<void>}\n   */\n  async handleModelUpdate(model) {\n    const accuracy = await this.trainingViz.estimateAccuracy(model);\n    /**\n     * Emitted when the accuracy of the model is estimated.\n     *\n     * @event TrainingController.events#accuracy\n     * @type {number}\n     * @property {number} accuracy\n     *  The estimated accuracy of the model.\n     */\n    this.events.emit('accuracy', accuracy);\n  }\n}\n","export default class TrainingViz {\n    constructor(trainingController) {\n        this.trainingController = trainingController;\n        this.nnComponent = trainingController.nnComponent;\n        this.drawCanvas = this.nnComponent.$drawCanvas[0];\n        this.drawCanvasCtx = this.drawCanvas.getContext('2d');\n\n        this.trainDigitBuffer = document.createElement('canvas');\n        this.trainDigitBuffer.height = 28;\n        this.trainDigitBuffer.width = 28;\n    }\n\n    async init() {\n\n    }\n\n    async setCurrentTraining(trainXs, trainYs) {\n        const trainX1 = trainXs.slice([0, 0, 0, 0], [1, 28, 28, 1]); // only the first\n        const imageTensor = trainX1.reshape([28, 28, 1]); // first as image\n        await tf.browser.toPixels(imageTensor, this.trainDigitBuffer);\n        this.trainDigitBuffer.active = true;\n        this.currentDigit = imageTensor.dataSync();\n        this.computeActivations(trainX1);\n        const trainY1 = trainYs.slice([0, 0], [1, 10]); // only the first\n        [this.currentTarget] = trainY1.argMax([-1]).dataSync();\n        this.renderNetwork();\n        this.renderActivations();\n        // clean up\n        trainX1.dispose();\n        trainY1.dispose();\n        imageTensor.dispose();\n    }\n\n    computeActivations(input) {\n        const { nn } = this.trainingController;\n        if (nn.modelid === 'dense') {\n            const A1 = nn.model.layers[0].apply(input);\n            const A2 = nn.model.layers[1].apply(A1);\n            const A3 = nn.model.layers[2].apply(A2);\n            this.intermediateActivations = A2.dataSync().map(x => Math.abs(x) / 2);\n            this.currentProbabilities = A3.dataSync();\n            [this.currentTarget] = A3.argMax([-1]).dataSync();\n            A1.dispose();\n            A2.dispose();\n            A3.dispose();\n        } else {\n            const prediction = nn.model.predict(input);\n            this.currentProbabilities = prediction.dataSync();\n            [this.currentTarget] = prediction.argMax([-1]).dataSync();\n            prediction.dispose();\n        }\n    }\n\n    renderNetwork() {\n\n    }\n\n    clearActivations() {\n        this.drawCanvasCtx.clearRect(0, 0, this.drawCanvas.width, this.drawCanvas.height);\n    }\n\n    renderActivations() {\n        this.clearActivations();\n\n        if (this.trainDigitBuffer.active) {\n            const destOrigin = this.drawCanvas.width * 0.125;\n            const destSize = this.drawCanvas.width * 0.75;\n            // this.drawCanvasCtx.imageSmoothingEnabled = false; // no antialiasing\n            this.drawCanvasCtx.drawImage(this.trainDigitBuffer, 0, 0, 28, 28, destOrigin, destOrigin, destSize, destSize);\n            this.nnComponent.setClearTimeout();\n            this.nnComponent.setClearOnInput();\n        }\n\n        this.nnComponent.getBarChart().update(this.currentProbabilities, this.currentTarget);\n    }\n\n    async estimateAccuracy(model, testDataSize = 100) {\n        const { data }  = this.trainingController;\n        const accuracy = tf.tidy(() => {\n            const d = data.nextTestBatch(testDataSize);\n            const testXs = d.xs.reshape([testDataSize, 28, 28, 1]);\n            const testYs = d.labels;\n            return model.evaluate(testXs, testYs)[1].dataSync();\n        });\n\n        if (testDataSize < 1000 && accuracy > 0.9) {\n            // compute more exact accuracy if it is close to 100%\n            return await this.estimateAccuracy(model, 1000);\n        }\n\n        return (accuracy < 0.9) ?\n            Math.round(accuracy * 100) :\n            Math.round(accuracy * 1000) / 10;\n    }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar objectCreate = Object.create || objectCreatePolyfill\nvar objectKeys = Object.keys || objectKeysPolyfill\nvar bind = Function.prototype.bind || functionBindPolyfill\n\nfunction EventEmitter() {\n  if (!this._events || !Object.prototype.hasOwnProperty.call(this, '_events')) {\n    this._events = objectCreate(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nvar hasDefineProperty;\ntry {\n  var o = {};\n  if (Object.defineProperty) Object.defineProperty(o, 'x', { value: 0 });\n  hasDefineProperty = o.x === 0;\n} catch (err) { hasDefineProperty = false }\nif (hasDefineProperty) {\n  Object.defineProperty(EventEmitter, 'defaultMaxListeners', {\n    enumerable: true,\n    get: function() {\n      return defaultMaxListeners;\n    },\n    set: function(arg) {\n      // check whether the input is a positive number (whose value is zero or\n      // greater and not a NaN).\n      if (typeof arg !== 'number' || arg < 0 || arg !== arg)\n        throw new TypeError('\"defaultMaxListeners\" must be a positive number');\n      defaultMaxListeners = arg;\n    }\n  });\n} else {\n  EventEmitter.defaultMaxListeners = defaultMaxListeners;\n}\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || isNaN(n))\n    throw new TypeError('\"n\" argument must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\n// These standalone emit* functions are used to optimize calling of event\n// handlers for fast cases because emit() itself often has a variable number of\n// arguments and can be deoptimized because of that. These functions always have\n// the same number of arguments and thus do not get deoptimized, so the code\n// inside them can execute faster.\nfunction emitNone(handler, isFn, self) {\n  if (isFn)\n    handler.call(self);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self);\n  }\n}\nfunction emitOne(handler, isFn, self, arg1) {\n  if (isFn)\n    handler.call(self, arg1);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1);\n  }\n}\nfunction emitTwo(handler, isFn, self, arg1, arg2) {\n  if (isFn)\n    handler.call(self, arg1, arg2);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2);\n  }\n}\nfunction emitThree(handler, isFn, self, arg1, arg2, arg3) {\n  if (isFn)\n    handler.call(self, arg1, arg2, arg3);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2, arg3);\n  }\n}\n\nfunction emitMany(handler, isFn, self, args) {\n  if (isFn)\n    handler.apply(self, args);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].apply(self, args);\n  }\n}\n\nEventEmitter.prototype.emit = function emit(type) {\n  var er, handler, len, args, i, events;\n  var doError = (type === 'error');\n\n  events = this._events;\n  if (events)\n    doError = (doError && events.error == null);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    if (arguments.length > 1)\n      er = arguments[1];\n    if (er instanceof Error) {\n      throw er; // Unhandled 'error' event\n    } else {\n      // At least give some kind of context to the user\n      var err = new Error('Unhandled \"error\" event. (' + er + ')');\n      err.context = er;\n      throw err;\n    }\n    return false;\n  }\n\n  handler = events[type];\n\n  if (!handler)\n    return false;\n\n  var isFn = typeof handler === 'function';\n  len = arguments.length;\n  switch (len) {\n      // fast cases\n    case 1:\n      emitNone(handler, isFn, this);\n      break;\n    case 2:\n      emitOne(handler, isFn, this, arguments[1]);\n      break;\n    case 3:\n      emitTwo(handler, isFn, this, arguments[1], arguments[2]);\n      break;\n    case 4:\n      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);\n      break;\n      // slower\n    default:\n      args = new Array(len - 1);\n      for (i = 1; i < len; i++)\n        args[i - 1] = arguments[i];\n      emitMany(handler, isFn, this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n\n  events = target._events;\n  if (!events) {\n    events = target._events = objectCreate(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener) {\n      target.emit('newListener', type,\n          listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (!existing) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n          prepend ? [listener, existing] : [existing, listener];\n    } else {\n      // If we've already got an array, just append.\n      if (prepend) {\n        existing.unshift(listener);\n      } else {\n        existing.push(listener);\n      }\n    }\n\n    // Check for listener leak\n    if (!existing.warned) {\n      m = $getMaxListeners(target);\n      if (m && m > 0 && existing.length > m) {\n        existing.warned = true;\n        var w = new Error('Possible EventEmitter memory leak detected. ' +\n            existing.length + ' \"' + String(type) + '\" listeners ' +\n            'added. Use emitter.setMaxListeners() to ' +\n            'increase limit.');\n        w.name = 'MaxListenersExceededWarning';\n        w.emitter = target;\n        w.type = type;\n        w.count = existing.length;\n        if (typeof console === 'object' && console.warn) {\n          console.warn('%s: %s', w.name, w.message);\n        }\n      }\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    switch (arguments.length) {\n      case 0:\n        return this.listener.call(this.target);\n      case 1:\n        return this.listener.call(this.target, arguments[0]);\n      case 2:\n        return this.listener.call(this.target, arguments[0], arguments[1]);\n      case 3:\n        return this.listener.call(this.target, arguments[0], arguments[1],\n            arguments[2]);\n      default:\n        var args = new Array(arguments.length);\n        for (var i = 0; i < args.length; ++i)\n          args[i] = arguments[i];\n        this.listener.apply(this.target, args);\n    }\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = bind.call(onceWrapper, state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      list = events[type];\n      if (!list)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = objectCreate(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else\n          spliceOne(list, position);\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (!events.removeListener) {\n        if (arguments.length === 0) {\n          this._events = objectCreate(null);\n          this._eventsCount = 0;\n        } else if (events[type]) {\n          if (--this._eventsCount === 0)\n            this._events = objectCreate(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = objectKeys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = objectCreate(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (!events)\n    return [];\n\n  var evlistener = events[type];\n  if (!evlistener)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];\n};\n\n// About 1.5x faster than the two-arg version of Array#splice().\nfunction spliceOne(list, index) {\n  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)\n    list[i] = list[k];\n  list.pop();\n}\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction objectCreatePolyfill(proto) {\n  var F = function() {};\n  F.prototype = proto;\n  return new F;\n}\nfunction objectKeysPolyfill(obj) {\n  var keys = [];\n  for (var k in obj) if (Object.prototype.hasOwnProperty.call(obj, k)) {\n    keys.push(k);\n  }\n  return k;\n}\nfunction functionBindPolyfill(context) {\n  var fn = this;\n  return function () {\n    return fn.apply(context, arguments);\n  };\n}\n"]}