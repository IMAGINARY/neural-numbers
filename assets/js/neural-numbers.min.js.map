{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js/BarChart.js","js/MnistData.js","js/NeuralNetwork.js","js/Paint.js","js/main-lib.js","js/neural-numbers-component.js","js/training-component.js","js/training-controller.js","js/training-viz.js","node_modules/events/events.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","BarChart","el","_classCallCheck","this","cleanup","bars","cbarcontainer","document","createElement","className","classList","add","cbartext","innerHTML","concat","appendChild","firstChild","removeChild","probabilities","highlighted","arguments","undefined","dataset","probability","style","toggle","IMAGE_SIZE","NUM_TRAIN_ELEMENTS","NUM_DATASET_ELEMENTS","MnistData","shuffledTrainIndex","shuffledTestIndex","img","Image","canvas","ctx","getContext","willReadFrequently","imgRequest","Promise","resolve","reject","crossOrigin","onload","width","naturalWidth","height","naturalHeight","datasetBytesBuffer","ArrayBuffer","datasetBytesView","Float32Array","drawImage","imageData","getImageData","j","data","_this","datasetImages","src","labelsRequest","fetch","all","labelsResponse","Uint8Array","arrayBuffer","datasetLabels","trainIndices","tf","util","createShuffledIndices","testIndices","trainImages","slice","testImages","trainLabels","NUM_CLASSES","testLabels","batchSize","_this2","nextBatch","_this3","index","batchImagesArray","batchLabelsArray","idx","image","set","label","xs","tensor2d","labels","NeuralNetwork","options","Object","assign","trainingCallback","batchCallback","modelUpdateCallback","modelUpdateAsyncCallback","training","init","modelid","optimizerid","learningRate","activation","console","log","trainedimages","lastrainedimages","pausecbs","model","dispose","sequential","layers","conv2d","inputShape","kernelSize","filters","strides","kernelInitializer","maxPooling2d","poolSize","flatten","dense","units","optimizer","train","adam","sgd","compile","loss","metrics","TRAIN_DATA_SIZE","BATCH_SIZE","setBackend","tidy","d","nextTrainBatch","reshape","trainXs","trainYs","fit","callbacks","onEpochEnd","_onEpochEnd","_asyncToGenerator","regeneratorRuntime","mark","_callee","wrap","_context","prev","next","stop","apply","onBatchEnd","_onBatchEnd","_callee2","_context2","trainByBatchFromData","Math","min","setTimeout","pop","cb","push","addPauseCallback","pauseTraining","_BarChart","SCALE_FACTOR","LINEWIDTH","Paint","outputThreshold","nwvis","clearTimeoutTime","drawingChanged","barchart","drawingActive","clearOnInput","pos","x","y","createUI","empty","isdown","pointerId","eventname","eventfunctions","pointerdown","clear","removeClearTimeout","setPosition","pointermove","draw","pointerup","setClearTimeout","pointerleave","pointercancel","drawcanvas","addEventListener","passive","removeEventListener","querySelector","normalizecanvas","outputbars","outputdigit","inputbox","addEventListeners","updateDimensions","floor","clientWidth","window","onresize","drawcontext","normalizecontext","rect","getBoundingClientRect","clientX","left","clientY","top","clearTimeout","ox","oy","nx","ny","abs","remove","beginPath","lineWidth","lineCap","strokeStyle","moveTo","lineTo","stroke","fillStyle","fillRect","normalize","predict","SKIPFACTOR","boxsize","centerx","centery","bottom","right","totalweight","max","_tf$tidy2","predicted","_this4","_slicedToArray","imageTensor","browser","fromPixels","toFloat","mul","scalar","clipByValue","show","filter","k","result","dataSync","argMax","update","parentElement","removeEventListeners","_neuralNumbersComponent","_interopRequireDefault","_trainingController","_trainingComponent","attrFlag","attribute","defaultValue","$","each","element","props","modelPath","attr","inputPlaceholder","showBars","showNormalizer","showOutput","IMAGINARY","NeuralNumbers","NeuralNumbersTrainingController","NeuralNumbersTraining","_Paint","models","path","loadLayersModel","sent","abrupt","NeuralNumbersComponent","$element","defaultModel","paint","_this$props","safeInputPlaceholder","classes","verticalBars","addClass","toggleClass","$inputStage","appendTo","$drawCanvas","placeholderText","html","text","append","$normalizeStage","$normalizeCanvas","$probabilityStage","$bars","$outputStage","$output","loadModel","PAINT_CLEAR_TIMEOUT","swapModel","disableDrawing","enableDrawing","setClearOnInput","TrainingComponent","nnComponent","trainingController","imageCountLabelText","predictedAccuracyLabelText","$controlsL","$progress","$imageCount","$imageCountLabel","$imageCountValue","$accuracy","$accuracyLabel","$accuracyValue","$controlsR","$startPauseBtn","on","handleStartPauseBtn","bind","$stepBtn","handleStepBtn","$resetBtn","handleResetBtn","events","handleBatch","handleAccuracy","handleTrainingStart","handleTrainingPause","handleTrainingComplete","handleTrainingReset","disableButtons","enableButtons","isTraining","pause","start","step","reset","imageCount","accuracy","round","removeClass","disableTrainingButtons","enableTrainingButtons","_events","_NeuralNetwork","_trainingViz","_MnistData","TrainingController","maxTrainingImages","nn","handleTraining","handleModelUpdate","trainingViz","load","rebuildNetwork","setModel","emit","trainSingleStep","setCurrentTraining","estimateAccuracy","TrainingViz","drawCanvas","drawCanvasCtx","trainDigitBuffer","trainX1","toPixels","active","currentDigit","computeActivations","trainY1","currentTarget","renderNetwork","renderActivations","input","A1","A2","A3","_A3$argMax$dataSync2","prediction","_prediction$argMax$da2","intermediateActivations","map","currentProbabilities","clearRect","destOrigin","destSize","clearActivations","getBarChart","testDataSize","nextTestBatch","testXs","testYs","evaluate","objectCreate","create","proto","F","prototype","objectKeys","keys","obj","hasOwnProperty","Function","context","fn","EventEmitter","_eventsCount","_maxListeners","hasDefineProperty","defaultMaxListeners","defineProperty","value","err","$getMaxListeners","that","_addListener","target","type","listener","prepend","existing","w","m","TypeError","newListener","unshift","warned","String","name","emitter","count","warn","message","onceWrapper","fired","removeListener","wrapFn","args","Array","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","unwrapListeners","arrayClone","listenerCount","copy","enumerable","get","arg","setMaxListeners","isNaN","getMaxListeners","er","handler","doError","error","len","isFn","self","listeners","emitNone","arg1","emitOne","arg2","emitTwo","arg3","emitThree","emitMany","addListener","prependListener","once","prependOnceListener","list","position","originalListener","shift","spliceOne","removeAllListeners","key","rawListeners","eventNames","Reflect","ownKeys"],"mappings":"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","file":"neural-numbers.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","export default class BarChart {\n  constructor(el) {\n    this.el = el;\n    // cleanup potentially previously existing bars\n    this.cleanup();\n\n    this.bars = [];\n    for (let i = 0; i < 10; i += 1) {\n      const cbarcontainer = document.createElement('div');\n      cbarcontainer.className = 'barcontainer';\n      this.bars[i] = document.createElement('div');\n      this.bars[i].classList.add('bar');\n      const cbartext = document.createElement('div');\n      cbartext.className = 'bartxt';\n      cbartext.innerHTML = `${i}`;\n      cbarcontainer.appendChild(this.bars[i]);\n      cbarcontainer.appendChild(cbartext);\n      this.el.appendChild(cbarcontainer);\n    }\n  }\n\n  cleanup() {\n    while (this.el.firstChild) {\n      this.el.removeChild(this.el.firstChild);\n    }\n  }\n\n  update(probabilities, highlighted = -1) {\n    for (let i = 0; i < 10; i += 1) {\n      this.bars[i].dataset.probability = probabilities[i];\n      this.bars[i].style = `--probability: ${probabilities[i]}`;\n      this.bars[i].classList.toggle('highlighted', i === highlighted);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nconst IMAGE_SIZE = 784;\nconst NUM_CLASSES = 10;\nconst NUM_DATASET_ELEMENTS = 65000;\n\nconst NUM_TRAIN_ELEMENTS = NUM_DATASET_ELEMENTS*0.8 | 0; //80% TODO make this custoumizeable\nconst NUM_TEST_ELEMENTS = NUM_DATASET_ELEMENTS - NUM_TRAIN_ELEMENTS;\n\nconst MNIST_IMAGES_SPRITE_PATH =\n    'assets/mnist/mnist_images.png';\nconst MNIST_LABELS_PATH =\n    'assets/mnist/mnist_labels_uint8';\n\n/**\n * A class that fetches the sprited MNIST dataset and returns shuffled batches.\n *\n * NOTE: This will get much easier. For now, we do data fetching and\n * manipulation manually.\n */\nexport class MnistData {\n  constructor() {\n    this.shuffledTrainIndex = 0;\n    this.shuffledTestIndex = 0;\n  }\n\n  async load() {\n    // Make a request for the MNIST sprited image.\n    const img = new Image();\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d', { willReadFrequently: true });\n    const imgRequest = new Promise((resolve, reject) => {\n      img.crossOrigin = '';\n      img.onload = () => {\n        img.width = img.naturalWidth;\n        img.height = img.naturalHeight;\n\n        const datasetBytesBuffer =\n            new ArrayBuffer(NUM_DATASET_ELEMENTS * IMAGE_SIZE * 4);\n\n        const chunkSize = 5000;\n        canvas.width = img.width;\n        canvas.height = chunkSize;\n\n        for (let i = 0; i < NUM_DATASET_ELEMENTS / chunkSize; i++) {\n          const datasetBytesView = new Float32Array(\n              datasetBytesBuffer, i * IMAGE_SIZE * chunkSize * 4,\n              IMAGE_SIZE * chunkSize);\n          ctx.drawImage(\n              img, 0, i * chunkSize, img.width, chunkSize, 0, 0, img.width,\n              chunkSize);\n\n          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n          for (let j = 0; j < imageData.data.length / 4; j++) {\n            // All channels hold an equal value since the image is grayscale, so\n            // just read the red channel.\n            datasetBytesView[j] = imageData.data[j * 4] / 255;\n          }\n        }\n        this.datasetImages = new Float32Array(datasetBytesBuffer);\n\n        resolve();\n      };\n      img.src = MNIST_IMAGES_SPRITE_PATH;\n    });\n\n    const labelsRequest = fetch(MNIST_LABELS_PATH);\n    const [imgResponse, labelsResponse] =\n        await Promise.all([imgRequest, labelsRequest]);\n\n    this.datasetLabels = new Uint8Array(await labelsResponse.arrayBuffer());\n    // Create shuffled indices into the train/test set for when we select a\n    // random dataset element for training / validation.\n    this.trainIndices = tf.util.createShuffledIndices(NUM_TRAIN_ELEMENTS);\n    this.testIndices = tf.util.createShuffledIndices(NUM_TEST_ELEMENTS);\n\n    // Slice the the images and labels into train and test sets.\n    this.trainImages =\n        this.datasetImages.slice(0, IMAGE_SIZE * NUM_TRAIN_ELEMENTS);\n    this.testImages = this.datasetImages.slice(IMAGE_SIZE * NUM_TRAIN_ELEMENTS);\n    this.trainLabels =\n        this.datasetLabels.slice(0, NUM_CLASSES * NUM_TRAIN_ELEMENTS);\n    this.testLabels =\n        this.datasetLabels.slice(NUM_CLASSES * NUM_TRAIN_ELEMENTS);\n  }\n\n  nextTrainBatch(batchSize) {\n    return this.nextBatch(\n        batchSize, [this.trainImages, this.trainLabels], () => {\n          this.shuffledTrainIndex =\n              (this.shuffledTrainIndex + 1) % this.trainIndices.length;\n          return this.trainIndices[this.shuffledTrainIndex];\n        });\n  }\n\n  nextTestBatch(batchSize) {\n    return this.nextBatch(batchSize, [this.testImages, this.testLabels], () => {\n      this.shuffledTestIndex =\n          (this.shuffledTestIndex + 1) % this.testIndices.length;\n      return this.testIndices[this.shuffledTestIndex];\n    });\n  }\n\n  nextBatch(batchSize, data, index) {\n    const batchImagesArray = new Float32Array(batchSize * IMAGE_SIZE);\n    const batchLabelsArray = new Uint8Array(batchSize * NUM_CLASSES);\n\n    for (let i = 0; i < batchSize; i++) {\n      const idx = index();\n\n      const image =\n          data[0].slice(idx * IMAGE_SIZE, idx * IMAGE_SIZE + IMAGE_SIZE);\n      batchImagesArray.set(image, i * IMAGE_SIZE);\n\n      const label =\n          data[1].slice(idx * NUM_CLASSES, idx * NUM_CLASSES + NUM_CLASSES);\n      batchLabelsArray.set(label, i * NUM_CLASSES);\n    }\n\n    const xs = tf.tensor2d(batchImagesArray, [batchSize, IMAGE_SIZE]);\n    const labels = tf.tensor2d(batchLabelsArray, [batchSize, NUM_CLASSES]);\n\n    return {xs, labels};\n  }\n}\n","/* eslint-disable no-await-in-loop */\n/* jshint esversion: 8 */\n/* globals tf */\n\nexport default class NeuralNetwork {\n  constructor(options) {\n    this.options = Object.assign({}, {\n      trainingCallback: null,\n      batchCallback: null,\n      modelUpdateCallback: null,\n      modelUpdateAsyncCallback: null,\n    }, options);\n    this.training = false;\n    this.init();\n  }\n\n  init(modelid = 'dense', optimizerid = 'adam', learningRate = 0.001, activation = 'relu') {\n    // eslint-disable-next-line no-console\n    console.log(`Setting up NN model=${modelid} optimizer=${optimizerid} learningrate=${learningRate} activation=${activation}`);\n    this.modelid = modelid;\n    this.trainedimages = 0;\n    this.lastrainedimages = 0;\n    this.pausecbs = [];\n\n    if (this.options.batchCallback) {\n      this.options.batchCallback(this.trainedimages);\n    }\n\n    // delete old model if it has been existing\n    if (this.model) {\n      this.model.dispose();\n    }\n\n    // create model\n    this.model = tf.sequential();\n    const { model } = this;\n\n    const IMAGE_WIDTH = 28;\n    const IMAGE_HEIGHT = 28;\n    const IMAGE_CHANNELS = 1;\n\n    if (modelid === 'cnn') {\n      // CNN\n      // In the first layer of our convolutional neural network we have\n      // to specify the input shape. Then we specify some parameters for\n      // the convolution operation that takes place in this layer.\n      model.add(tf.layers.conv2d({\n        inputShape: [IMAGE_WIDTH, IMAGE_HEIGHT, IMAGE_CHANNELS],\n        kernelSize: 5,\n        filters: 8,\n        strides: 1,\n        activation,\n        kernelInitializer: 'varianceScaling',\n      }));\n\n      // The MaxPooling layer acts as a sort of downsampling using max values\n      // in a region instead of averaging.\n      model.add(tf.layers.maxPooling2d({\n        poolSize: [2, 2],\n        strides: [2, 2],\n      }));\n\n      // Repeat another conv2d + maxPooling stack.\n      // Note that we have more filters in the convolution.\n      model.add(tf.layers.conv2d({\n        kernelSize: 5,\n        filters: 16,\n        strides: 1,\n        activation,\n        kernelInitializer: 'varianceScaling',\n      }));\n      model.add(tf.layers.maxPooling2d({\n        poolSize: [2, 2],\n        strides: [2, 2],\n      }));\n\n      // Now we flatten the output from the 2D filters into a 1D vector to prepare\n      // it for input into our last layer. This is common practice when feeding\n      // higher dimensional data to a final classification output layer.\n      model.add(tf.layers.flatten());\n    } else if (modelid === 'dense') {\n      model.add(\n        tf.layers.flatten({\n          inputShape: [IMAGE_WIDTH, IMAGE_HEIGHT, IMAGE_CHANNELS],\n        })\n      );\n\n      model.add(tf.layers.dense({\n        units: 100,\n        activation,\n        kernelInitializer: 'varianceScaling',\n      }));\n    } else if (modelid === 'nohidden') {\n      model.add(\n        tf.layers.flatten({\n          inputShape: [IMAGE_WIDTH, IMAGE_HEIGHT, IMAGE_CHANNELS],\n        })\n      );\n    }\n\n    // Our last layer is a dense layer which has 10 output units, one for each\n    // output class (i.e. 0, 1, 2, 3, 4, 5, 6, 7, 8, 9).\n    const NUM_OUTPUT_CLASSES = 10;\n    model.add(tf.layers.dense({\n      units: NUM_OUTPUT_CLASSES,\n      kernelInitializer: 'varianceScaling',\n      activation: 'softmax',\n    }));\n\n    // Choose an optimizer, loss function and accuracy metric,\n    // then compile and return the model\n    const optimizer = (optimizerid === 'adam') ? tf.train.adam(learningRate) : tf.train.sgd(learningRate);\n    // tf.train.adam(learningRate);\n\n    model.compile({\n      optimizer,\n      loss: 'categoricalCrossentropy',\n      // optimizer: 'sgd',\n      // loss: 'meanSquaredError',\n      metrics: ['accuracy'],\n    });\n\n    return model;\n  }\n\n  async trainByBatchFromData(data, TRAIN_DATA_SIZE, BATCH_SIZE) {\n    if (TRAIN_DATA_SIZE === 1 || BATCH_SIZE === 1) {\n      tf.setBackend('cpu');\n      // fitting with single training-data results in NaNs when WebGL-backend is used\n      // for unknown reasons. Unfortunately, mixing cpu ang webgl backend changes the\n      // training in some way: Way more input images are required to obtain same accuracy\n    }\n    const { model } = this;\n    const [trainXs, trainYs] = tf.tidy(() => {\n      const d = data.nextTrainBatch(TRAIN_DATA_SIZE);\n      return [\n        d.xs.reshape([TRAIN_DATA_SIZE, 28, 28, 1]),\n        d.labels,\n      ];\n    });\n\n    if (this.options.trainingCallback) {\n      await this.options.trainingCallback(trainXs, trainYs);\n    }\n\n    await model.fit(trainXs, trainYs, {\n      batchSize: BATCH_SIZE,\n      callbacks: {\n        onEpochEnd: async () => {},\n        onBatchEnd: async () => {\n          this.trainedimages += BATCH_SIZE;\n          if (this.options.batchCallback) {\n            this.options.batchCallback(this.trainedimages);\n          }\n        },\n      },\n    });\n    tf.dispose(trainXs);\n    tf.dispose(trainYs);\n\n    if (TRAIN_DATA_SIZE === 1 || BATCH_SIZE === 1) {\n      tf.setBackend('webgl');\n      // fitting with single training-data results in NaNs when WebGL-backend\n      // is used for unknown reasons\n    }\n  }\n\n  async trainSingleStep(data) {\n    await this.trainByBatchFromData(data, 1, 1);\n    if (this.options.modelUpdateCallback) {\n      this.options.modelUpdateCallback(this.model);\n    }\n    if (this.options.modelUpdateAsyncCallback) {\n      await this.options.modelUpdateAsyncCallback(this.model);\n    }\n  }\n\n  async train(data) {\n    this.training = true;\n\n    while (this.training) {\n      // start slower in beginning, increase step size with time\n      // const BATCH_SIZE = 1 << (Math.max(4, Math.min(8, this.trainedimages / 20 | 0)));\n      // a sequence of increasing powers of two\n\n      // a constant BATCH_SIZE and TRAIN_DATA_SIZE increases the speed of convergence :/.\n      const BATCH_SIZE = 32;\n      const TRAIN_DATA_SIZE = 32; // *Math.min(8, Math.max(1, this.trainedimages / 40 | 0));\n\n      await this.trainByBatchFromData(data, BATCH_SIZE, TRAIN_DATA_SIZE);\n\n      if (this.trainedimages\n        > this.lastrainedimages + Math.min(1000, 0.3 * this.trainedimages)\n        || this.trainedimages < 250) {\n        if (this.options.modelUpdateCallback) {\n          this.options.modelUpdateCallback(this.model);\n        }\n        if (this.options.modelUpdateAsyncCallback) {\n          await this.options.modelUpdateAsyncCallback(this.model);\n        }\n        if ((this.trainedimages < 100)) {\n          // sleep some time per image\n          await new Promise(resolve => setTimeout(\n            resolve,\n            (1000 / (5 + 4 * this.trainedimages)) * (this.trainedimages - this.lastrainedimages)\n          ));\n        }\n        this.lastrainedimages = this.trainedimages;\n      }\n    }\n\n    while (this.pausecbs.length > 0) {\n      (this.pausecbs.pop())();\n    }\n  }\n\n  addPauseCallback(cb) {\n    this.pausecbs.push(cb);\n  }\n\n  pauseTraining() {\n    return new Promise((resolve) => {\n      if (this.training) {\n        this.addPauseCallback(resolve);\n        this.training = false;\n      } else {\n        resolve();\n      }\n    });\n  }\n\n  isTraining() {\n    return this.training;\n  }\n\n  async toggleTraining(data) {\n    if (this.training) {\n      await this.pauseTraining();\n    } else {\n      await this.train(data);\n    }\n  }\n\n  cleanup() {\n    this.model.dispose();\n    this.trainedimages = 0;\n    this.lastrainedimages = 0;\n  }\n}\n","/* globals tf */\n/* eslint-disable no-bitwise */\nimport BarChart from './BarChart.js';\n\nlet SCALE_FACTOR = 9;\nlet LINEWIDTH = 2 * SCALE_FACTOR;\n\nexport default class Paint {\n  constructor(el, model, outputThreshold, nwvis = false, clearTimeoutTime = 2.2) {\n    this.clearTimeoutTime = clearTimeoutTime;\n    this.drawingChanged = true;\n    this.model = model;\n    this.nwvis = nwvis;\n    this.barchart = null;\n    this.drawingActive = true;\n    this.clearOnInput = false;\n\n    this.outputThreshold = outputThreshold;\n\n    // last known position\n    this.pos = {\n      x: 0,\n      y: 0,\n    };\n\n    this.createUI(el);\n    this.empty = true;\n    this.isdown = false;\n    this.pointerId = -1;\n  }\n\n  addEventListeners() {\n    this.eventfunctions = {\n      pointerdown: ((e) => {\n        if (!this.isdown && this.drawingActive) {\n          if (this.clearOnInput) {\n            this.clear();\n          }\n          this.removeClearTimeout();\n          this.setPosition(e);\n          this.isdown = true;\n          this.pointerId = e.pointerId;\n        }\n      }),\n      pointermove: ((e) => {\n        if (this.isdown && this.drawingActive && (this.pointerId === e.pointerId)) {\n          this.draw(e);\n        }\n      }),\n      pointerup: ((e) => {\n        if (this.drawingActive && (this.pointerId === e.pointerId)) {\n          this.setClearTimeout();\n          this.isdown = false;\n        }\n      }),\n      pointerleave: ((e) => {\n        if (this.drawingActive && (this.pointerId === e.pointerId)) {\n          this.setClearTimeout();\n          this.isdown = false;\n        }\n      }),\n      pointercancel: ((e) => {\n        if (this.drawingActive && (this.pointerId === e.pointerId)) {\n          this.setClearTimeout();\n          this.isdown = false;\n        }\n      }),\n    };\n\n    for (const eventname in this.eventfunctions) {\n      this.drawcanvas.addEventListener(eventname, this.eventfunctions[eventname], {\n        passive: true,\n      });\n    }\n  }\n\n  removeEventListeners() {\n    for (const eventname in this.eventfunctions) {\n      this.drawcanvas.removeEventListener(eventname, this.eventfunctions[eventname]);\n    }\n  }\n\n  createUI(el) {\n    this.drawcanvas = el.querySelector('.drawcanvas');\n    this.normalizecanvas = el.querySelector('.normalizecanvas') || document.createElement('canvas');\n    this.outputbars = el.querySelector('.bars');\n    this.outputdigit = el.querySelector('.digit');\n    this.inputbox = el.querySelector('.input.box');\n\n    this.addEventListeners();\n\n    const { normalizecanvas, drawcanvas } = this;\n\n    normalizecanvas.width = 28;\n    normalizecanvas.height = 28;\n\n    const updateDimensions = () => {\n      SCALE_FACTOR = Math.floor(this.drawcanvas.clientWidth / 28) - 1;\n      LINEWIDTH = 2 * SCALE_FACTOR;\n      drawcanvas.width = this.drawcanvas.clientWidth;\n      drawcanvas.height = this.drawcanvas.clientWidth;\n    };\n    updateDimensions();\n    window.onresize = () => {\n      updateDimensions();\n    };\n\n    this.drawcontext = this.drawcanvas.getContext('2d', { willReadFrequently: true });\n    this.normalizecontext = this.normalizecanvas.getContext('2d', { willReadFrequently: true });\n    // const { drawcontext, normalizecontext } = this;\n    //  normalizecanvas.style.width = 28 * SCALE_FACTOR + 'px';\n    //  normalizecanvas.style.height = 28 * SCALE_FACTOR + 'px';\n    //  normalizecanvas.style.imageRendering = 'pixelated';\n    /*\n        const resetbutton = document.createElement(\"button\");\n        this.resetbutton = resetbutton;\n        this.resetbutton.style.visibility = 'hidden';\n\n        resetbutton.innerHTML = \"reset\";\n        resetbutton.addEventListener('click', () => {\n          this.drawcontext.fillRect(0, 0, this.drawcanvas.width, this.drawcanvas.height);\n          this.normalize(100);\n          this.predict();\n          this.resetbutton.style.visibility = 'hidden';\n        });\n\n        this.drawcanvas.parentNode.insertBefore(resetbutton, this.drawcanvas);\n        this.resetbutton.style.position = \"absolute\";\n        this.resetbutton.style.zIndex = 10;\n    */\n    if (this.outputbars) {\n      this.barchart = new BarChart(this.outputbars);\n    }\n\n    this.clear();\n  }\n\n\n  setPosition(e) {\n    const rect = this.drawcanvas.getBoundingClientRect();\n    this.pos.x = (e.clientX - rect.left);\n    this.pos.y = (e.clientY - rect.top);\n    return true;\n  }\n\n  removeClearTimeout() {\n    if (this.clearTimeout) {\n      clearTimeout(this.clearTimeout);\n    }\n    return true;\n  }\n\n  setClearTimeout() {\n    this.removeClearTimeout(); // remove previous clearTimeouts\n    // clean up everything after specified time\n    this.clearTimeout = setTimeout(() => {\n      this.clear();\n    }, this.clearTimeoutTime * 1000);\n    return true;\n  }\n\n  setClearOnInput() {\n    this.clearOnInput = true;\n  }\n\n  draw(e) {\n    this.removeClearTimeout();\n    const ox = this.pos.x;\n    const oy = this.pos.y;\n    this.setPosition(e);\n    const nx = this.pos.x;\n    const ny = this.pos.y;\n    if (Math.abs(nx - ox) + Math.abs(ny - oy) < 3) {\n      this.pos.x = ox;\n      this.pos.y = oy;\n      return;\n    }\n    this.inputbox.classList.remove('background');\n    this.empty = false;\n    this.drawcontext.beginPath(); // begin\n    this.drawcontext.lineWidth = LINEWIDTH;\n    this.drawcontext.lineCap = 'round';\n    this.drawcontext.strokeStyle = 'white';\n\n    this.drawcontext.moveTo(ox, oy); // from\n    this.setPosition(e);\n    this.drawcontext.lineTo(nx, ny); // to\n\n    this.drawcontext.stroke(); // draw it!\n\n    this.normalizecontext.fillStyle = 'black';\n    this.normalizecontext.fillRect(0, 0, this.normalizecanvas.width, this.normalizecanvas.height);\n\n    this.drawingChanged = true;\n    this.normalize(LINEWIDTH);\n    this.predict();\n    // this.resetbutton.style.visibility = 'visible';\n  }\n\n  // normalize image\n  normalize(SKIPFACTOR) {\n    let centerx = 0;\n    let centery = 0;\n    let top = 1000;\n    let bottom = -1000;\n    let left = 1000;\n    let right = -1000;\n    const imgData = this.drawcontext.getImageData(\n      0, 0, this.drawcanvas.width, this.drawcanvas.height\n    );\n    const { data } = imgData;\n    let totalweight = 0;\n    for (let i = 0; i < data.length; i += 4 * SKIPFACTOR) {\n      const x = (i / 4) % this.drawcanvas.width;\n      const y = ((i / 4) / (this.drawcanvas.width)) | 0;\n      totalweight += data[i];\n      centerx += (data[i]) * x;\n      centery += (data[i]) * y;\n\n      if (data[i] > 0) {\n        top = Math.min(top, y);\n        bottom = Math.max(bottom, y);\n        left = Math.min(left, x);\n        right = Math.max(right, x);\n      }\n    }\n    if (totalweight > 0) {\n      centerx /= totalweight;\n      centery /= totalweight;\n\n      const boxsize = Math.max(right - left, bottom - top);\n\n      // according to MNIST normalization:\n      /*\n      The original black and white (bilevel) images from NIST were size normalized\n      to fit in a 20x20 pixel box while preserving their aspect ratio. The\n      resulting images contain grey levels as a result of the anti-aliasing\n      technique used by the normalization algorithm. the images were centered\n      in a 28x28 image by computing the center of mass of the pixels, and\n      translating the image so as to position this point at the center of the 28x28 field.\n      */\n      this.normalizecontext.drawImage(\n        this.drawcanvas,\n        left, top,\n        boxsize, boxsize,\n        14 + (20 / boxsize) * (left - centerx),\n        14 + (20 / boxsize) * (top - centery),\n        20, 20\n      );\n    } else {\n      this.normalizecontext.fillRect(0, 0, this.normalizecanvas.width, this.normalizecanvas.height);\n    }\n\n    return true;\n  }\n\n  predict() {\n    if (this.model && this.normalizecanvas && this.drawingChanged) { // && newFrame rendered TODO?\n      const [probabilities, predicted] = tf.tidy(() => {\n        const imageTensor = tf.browser\n          .fromPixels(this.normalizecanvas, 1)\n          .toFloat()\n          .mul(tf.scalar(1 / 255))\n          .clipByValue(0, 1)\n          .reshape([1, 28, 28, 1]);\n        if (this.nwvis) {\n          this.nwvis.show(imageTensor,\n            this.normalizecontext.getImageData(\n              0, 0,\n              this.normalizecanvas.width, this.normalizecanvas.height\n            ).data.filter((d, k) => (k % 4 === 0)));\n        }\n        const result = this.model.predict(imageTensor);\n        return [\n          result.dataSync(),\n          result.argMax([-1]).dataSync(),\n        ];\n      });\n\n      if (this.barchart) {\n        this.barchart.update(probabilities, predicted);\n      }\n\n      if (this.outputdigit) {\n        this.outputdigit.innerHTML = (!this.empty && probabilities[predicted] > this.outputThreshold) ? predicted : '?';\n        this.outputdigit.parentElement.classList.toggle('solved', probabilities[predicted] > this.outputThreshold);\n      }\n    }\n    return true;\n  }\n\n  swapModel(model) {\n    this.model = model;\n    this.predict();\n  }\n\n  clear() {\n    this.clearOnInput = false;\n    this.drawcontext.fillRect(0, 0, this.drawcanvas.width, this.drawcanvas.height);\n    this.empty = true;\n    this.normalize(100);\n    this.predict();\n    this.inputbox.classList.add('background');\n  }\n\n  cleanup() {\n    this.clear();\n    this.removeEventListeners();\n\n    // this.predict();\n    // this.resetbutton.style.visibility = 'hidden';\n\n    if (this.barchart) {\n      this.barchart.cleanup();\n    }\n  }\n\n  disableDrawing() {\n    this.drawingActive = false;\n    this.isdown = false;\n  }\n\n  enableDrawing() {\n    this.drawingActive = true;\n  }\n}\n","import NeuralNumbersComponent from './neural-numbers-component';\nimport TrainingController from './training-controller';\nimport TrainingComponent from \"./training-component\";\n\nfunction attrFlag(attribute, defaultValue) {\n  if (attribute === undefined) {\n    return defaultValue;\n  }\n  return attribute !== 'false';\n}\n\n$('[data-component=neural-numbers]')\n  .each((i, element) => {\n    const props = {\n      modelPath: $(element).attr('data-model') || null,\n      inputPlaceholder: $(element).attr('data-input-placeholder') || '',\n      showBars: attrFlag($(element).attr('data-show-bars'), false),\n      showNormalizer: attrFlag($(element).attr('data-show-normalizer'), false),\n      showOutput: attrFlag($(element).attr('data-show-output'), true),\n    };\n    const component = new NeuralNumbersComponent(element, props);\n    component.init();\n  });\n\nif (window.IMAGINARY === undefined) {\n  window.IMAGINARY = {};\n}\n\nif (window.IMAGINARY.NeuralNumbers === undefined) {\n  window.IMAGINARY.NeuralNumbers = NeuralNumbersComponent;\n  window.IMAGINARY.NeuralNumbersTrainingController = TrainingController;\n  window.IMAGINARY.NeuralNumbersTraining = TrainingComponent;\n}\n","/* globals tf */\n\nimport Paint from './Paint';\n\nconst models = {};\n\nasync function loadModel(path) {\n  if (path && !(path in models)) {\n    models[path] = await tf.loadLayersModel(path);\n  }\n  return models[path];\n}\n\nexport default class NeuralNumbersComponent {\n  constructor(element, props) {\n    this.$element = $(element);\n    this.props = props;\n    this.defaultModel = null;\n    this.model = null;\n    this.paint = null;\n\n    const {\n      inputPlaceholder,\n      safeInputPlaceholder,\n      classes,\n      showBars,\n      showNormalizer,\n      showOutput,\n      verticalBars\n    } = this.props;\n\n    this.$element.addClass('neural-numbers-component');\n    this.$element.toggleClass('with-bars', showBars);\n    this.$element.toggleClass('with-normalizer', showNormalizer);\n    this.$element.toggleClass('with-output', showOutput);\n    if (classes) {\n      this.$element.addClass(classes);\n    }\n\n    this.$inputStage = $('<div>')\n      .addClass(['stage', 'stage-input', 'input', 'box'])\n      .appendTo(this.$element);\n\n    this.$drawCanvas = $('<canvas>')\n      .addClass(['drawcanvas', 'input-canvas'])\n      .appendTo(\n        $('<div>')\n          .addClass('input-canvas-wrapper')\n          .appendTo(this.$inputStage)\n      );\n\n    const placeholderText = $('<span>');\n    if (inputPlaceholder) {\n      placeholderText.html(inputPlaceholder);\n    } else if (safeInputPlaceholder) {\n      placeholderText.text(safeInputPlaceholder);\n    }\n    $('<div>')\n        .addClass('input-placeholder')\n        .append(placeholderText)\n        .appendTo(this.$inputStage);\n\n    this.$normalizeStage = $('<div>')\n      .addClass(['stage', 'stage-normalize'])\n      .appendTo(this.$element);\n\n    this.$normalizeCanvas = $('<canvas>')\n      .addClass('normalizecanvas')\n      .appendTo($('<div>')\n        .addClass('normalize-canvas-wrapper')\n        .appendTo(this.$normalizeStage));\n\n    this.$probabilityStage = $('<div>')\n      .addClass(['stage', 'stage-bars'])\n      .appendTo(this.$element);\n\n    this.$bars = $('<div>')\n      .addClass('bars')\n      .toggleClass('bars-vertical', verticalBars || false)\n      .appendTo(this.$probabilityStage);\n\n    this.$outputStage = $('<div>')\n      .addClass(['stage', 'stage-output'])\n      .appendTo(this.$element);\n\n    this.$output = $('<div>')\n      .addClass(['output', 'digit'])\n      .appendTo($('<div>')\n        .addClass('output-wrapper')\n        .appendTo(this.$outputStage));\n  }\n\n  async init() {\n    const { modelPath } = this.props;\n    this.defaultModel = await loadModel(modelPath);\n    this.model = this.defaultModel;\n\n    this.paint = new Paint(\n      this.$element[0],\n      this.model,\n      0.5,\n      false,\n      NeuralNumbersComponent.PAINT_CLEAR_TIMEOUT);\n  }\n\n  setModel(model = null) {\n    if (model === null) {\n      model = this.defaultModel;\n    }\n    this.model = model;\n    this.paint.swapModel(model);\n  }\n\n  getBarChart() {\n    return this.paint.barchart;\n  }\n\n  disableDrawing() {\n    this.paint.disableDrawing();\n  }\n\n  enableDrawing() {\n    this.paint.enableDrawing();\n  }\n\n  setClearTimeout() {\n    this.paint.setClearTimeout();\n  }\n\n  setClearOnInput() {\n    this.paint.setClearOnInput();\n  }\n}\n\nNeuralNumbersComponent.PAINT_CLEAR_TIMEOUT = 2.2;\n","import TrainingController from \"./training-controller\";\n\nexport default class TrainingComponent {\n    constructor(nnComponent, element, props = {}) {\n        this.trainingController = new TrainingController(nnComponent, props);\n        this.nnComponent = nnComponent;\n        this.$element = $(element);\n        this.props = Object.assign({}, {\n            imageCountLabelText: 'Images used:',\n            predictedAccuracyLabelText: 'Predicted accuracy:',\n        }, props);\n\n        this.$element.addClass('neural-numbers-training-component');\n\n        this.$controlsL = $('<div>')\n            .addClass(['controls', 'controls-l'])\n            .appendTo(this.$element);\n\n        this.$progress = $('<div>')\n            .addClass('progress')\n            .appendTo(this.$element);\n\n        this.$imageCount = $('<div>')\n            .addClass('image-count')\n            .appendTo(this.$progress);\n\n        this.$imageCountLabel = $('<div>')\n            .addClass('image-count-label')\n            .html(this.props.imageCountLabelText)\n            .appendTo(this.$imageCount);\n\n        this.$imageCountValue = $('<div>')\n            .addClass('image-count-value')\n            .appendTo(this.$imageCount);\n\n        this.$accuracy = $('<div>')\n            .addClass('accuracy')\n            .appendTo(this.$progress);\n\n        this.$accuracyLabel = $('<div>')\n            .addClass('accuracy-label')\n            .html(this.props.predictedAccuracyLabelText)\n            .appendTo(this.$accuracy);\n\n        this.$accuracyValue = $('<div>')\n            .addClass('accuracy-value')\n            .appendTo(this.$accuracy);\n\n        this.$controlsR = $('<div>')\n            .addClass(['controls', 'controls-r'])\n            .appendTo(this.$element);\n\n        this.$startPauseBtn = $('<button>')\n            .addClass(['start-pause-btn', 'btn'])\n            .text('Start')\n            .on('click', this.handleStartPauseBtn.bind(this))\n            .appendTo(this.$controlsL);\n\n        this.$stepBtn = $('<button>')\n            .addClass(['step-btn', 'btn'])\n            .text('Step')\n            .on('click', this.handleStepBtn.bind(this))\n            .appendTo(this.$controlsL);\n\n        this.$resetBtn = $('<button>')\n            .addClass(['reset-btn', 'btn'])\n            .text('Reset')\n            .on('click', this.handleResetBtn.bind(this))\n            .appendTo(this.$controlsR);\n\n        this.trainingController.events.on('batch', this.handleBatch.bind(this));\n        this.trainingController.events.on('accuracy', this.handleAccuracy.bind(this));\n        this.trainingController.events.on('start', this.handleTrainingStart.bind(this));\n        this.trainingController.events.on('pause', this.handleTrainingPause.bind(this));\n        this.trainingController.events.on('training-complete', this.handleTrainingComplete.bind(this));\n        this.trainingController.events.on('reset', this.handleTrainingReset.bind(this));\n\n        this.disableButtons();\n    }\n\n    async init() {\n        await this.trainingController.init();\n        this.enableButtons();\n    }\n\n    disableButtons() {\n        this.$startPauseBtn.attr('disabled', true);\n        this.$stepBtn.attr('disabled', true);\n        this.$resetBtn.attr('disabled', true);\n    }\n\n    enableButtons() {\n        this.$startPauseBtn.attr('disabled', false);\n        this.$stepBtn.attr('disabled', false);\n        this.$resetBtn.attr('disabled', false);\n    }\n\n    disableTrainingButtons() {\n        this.$startPauseBtn.attr('disabled', true);\n        this.$stepBtn.attr('disabled', true);\n    }\n\n    enableTrainingButtons() {\n        this.$startPauseBtn.attr('disabled', false);\n        this.$stepBtn.attr('disabled', false);\n    }\n\n    handleStartPauseBtn() {\n        if (this.trainingController.isTraining()) {\n            this.trainingController.pause();\n        } else {\n            this.trainingController.start();\n        }\n    }\n\n    handleStepBtn() {\n        this.trainingController.step();\n    }\n\n    handleResetBtn() {\n        this.trainingController.reset();\n    }\n\n    handleBatch(imageCount) {\n        this.$imageCountValue.text(imageCount);\n    }\n\n    handleAccuracy(accuracy) {\n        this.$accuracyValue.attr('data-ranking', accuracy > 50 ? accuracy > 85 ? 'good' : 'mediocre' : 'bad');\n        this.$accuracyValue.text(`${Math.round(accuracy)}%`);\n    }\n\n    handleTrainingStart() {\n        this.$startPauseBtn.text('Pause');\n        this.$element.addClass('running');\n        this.nnComponent.disableDrawing();\n    }\n\n    handleTrainingPause() {\n        this.$startPauseBtn.text('Start');\n        this.$element.removeClass('running');\n        this.nnComponent.enableDrawing();\n    }\n\n    handleTrainingComplete() {\n        this.disableTrainingButtons();\n    }\n\n    handleTrainingReset() {\n        this.enableTrainingButtons();\n    }\n}\n","import EventEmitter from 'events';\nimport NeuralNetwork from './NeuralNetwork';\nimport TrainingViz from \"./training-viz\";\nimport { MnistData } from './MnistData';\n\n/**\n * A class to make a Neural Numbers component trainable.\n */\nexport default class TrainingController {\n  /**\n   * Constructor\n   *\n   * @param {NeuralNumbersComponent} nnComponent\n   *  A Neural Numbers component.\n   */\n  constructor(nnComponent, props) {\n    this.events = new EventEmitter();\n    this.nnComponent = nnComponent;\n\n    this.props = Object.assign({}, {\n      maxTrainingImages: 60000,\n    }, props);\n\n    this.nn = new NeuralNetwork({\n      trainingCallback: this.handleTraining.bind(this),\n      batchCallback: this.handleBatch.bind(this),\n      modelUpdateAsyncCallback: this.handleModelUpdate.bind(this),\n    });\n    this.data = new MnistData();\n    this.trainingViz = new TrainingViz(this);\n  }\n\n  /**\n   * Initialize the controller.\n   *\n   * Call this method before using the controller.\n   * @returns {Promise<void>}\n   */\n  async init() {\n    await this.data.load();\n    this.rebuildNetwork();\n  }\n\n  /**\n   * Resets the network to its untrained state.\n   * @protected\n   */\n  rebuildNetwork() {\n    this.nn.init();\n    this.nnComponent.setModel(this.nn.model);\n    this.handleModelUpdate(this.nn.model);\n    /**\n     * Emitted when the network is reset.\n     *\n     * @event TrainingController.events#reset\n     */\n    this.events.emit('reset');\n  }\n\n  /**\n   * Connects the Neural Numbers component to its original fully trained model.\n   */\n  useDefaultModel() {\n    this.nnComponent.setModel();\n    this.handleModelUpdate(this.nn.model);\n  }\n\n  /**\n   * Connects the Neural Numbers component to a new trainable model.\n   */\n  useTrainableModel() {\n    this.rebuildNetwork();\n  }\n\n  /**\n   * Returns whether the network is currently training.\n   * @returns {boolean}\n   */\n  isTraining() {\n    return this.nn.isTraining();\n  }\n\n  /**\n   * Starts training the network.\n   *\n   * @returns {Promise<void>}\n   * @fires TrainingController.events#start\n   * @fires TrainingController.events#batch\n   * @fires TrainingController.events#accuracy\n   */\n  async start() {\n    if (this.nn.trainedimages >= this.props.maxTrainingImages) {\n      return;\n    }\n    /**\n     * Emitted when training starts.\n     *\n     * @event TrainingController.events#start\n     */\n    this.events.emit('start');\n    await this.nn.train(this.data);\n  }\n\n  /**\n   * Pauses training the network.\n   *\n   * @returns {Promise<void>}\n   * @fires TrainingController.events#pause\n   */\n  async pause() {\n    await this.nn.pauseTraining();\n    /**\n     * Emitted when training pauses.\n     *\n     * @event TrainingController.events#pause\n     */\n    this.events.emit('pause');\n  }\n\n  /**\n   * Trains the network for a single step.\n   *\n   * @returns {Promise<void>}\n   * @fires TrainingController.events#batch\n   * @fires TrainingController.events#accuracy\n   */\n  async step() {\n    if (this.nn.trainedimages >= this.props.maxTrainingImages) {\n      return;\n    }\n    await this.nn.trainSingleStep(this.data);\n  }\n\n  /**\n   * Resets the network to its untrained state.\n   *\n   * @returns {Promise<void>}\n   */\n  async reset() {\n    await this.nn.pauseTraining();\n    this.rebuildNetwork();\n  }\n\n  /**\n   * Handles a batch of training images.\n   * @private\n   * @type {number}\n   * @param {number} imageCount\n   *  The number of images in the batch.\n   */\n  handleBatch(imageCount) {\n    /**\n     * Emitted when a batch of training images is processed.\n     *\n     * @event TrainingController.events#batch\n     * @type {number}\n     * @property {number} imageCount\n     *  The number of images in the batch.\n     */\n    this.events.emit('batch', imageCount);\n    if (imageCount >= this.props.maxTrainingImages) {\n      /**\n       * Emitted when training is complete.\n       *\n       * @event TrainingController.events#training-complete\n       */\n      this.events.emit('training-complete');\n      this.pause();\n    }\n  }\n\n  /**\n   * Handles a training step.\n   * @private\n   * @param trainXs\n   * @param trainYs\n   * @returns {Promise<void>}\n   */\n  async handleTraining(trainXs, trainYs) {\n    await this.trainingViz.setCurrentTraining(trainXs, trainYs);\n  }\n\n  /**\n   * Handles a model update.\n   * @private\n   * @param model\n   * @returns {Promise<void>}\n   */\n  async handleModelUpdate(model) {\n    const accuracy = await this.trainingViz.estimateAccuracy(model);\n    /**\n     * Emitted when the accuracy of the model is estimated.\n     *\n     * @event TrainingController.events#accuracy\n     * @type {number}\n     * @property {number} accuracy\n     *  The estimated accuracy of the model.\n     */\n    this.events.emit('accuracy', accuracy);\n  }\n}\n","export default class TrainingViz {\n    constructor(trainingController) {\n        this.trainingController = trainingController;\n        this.nnComponent = trainingController.nnComponent;\n        this.drawCanvas = this.nnComponent.$drawCanvas[0];\n        this.drawCanvasCtx = this.drawCanvas.getContext('2d');\n\n        this.trainDigitBuffer = document.createElement('canvas');\n        this.trainDigitBuffer.height = 28;\n        this.trainDigitBuffer.width = 28;\n    }\n\n    async init() {\n\n    }\n\n    async setCurrentTraining(trainXs, trainYs) {\n        const trainX1 = trainXs.slice([0, 0, 0, 0], [1, 28, 28, 1]); // only the first\n        const imageTensor = trainX1.reshape([28, 28, 1]); // first as image\n        await tf.browser.toPixels(imageTensor, this.trainDigitBuffer);\n        this.trainDigitBuffer.active = true;\n        this.currentDigit = imageTensor.dataSync();\n        this.computeActivations(trainX1);\n        const trainY1 = trainYs.slice([0, 0], [1, 10]); // only the first\n        [this.currentTarget] = trainY1.argMax([-1]).dataSync();\n        this.renderNetwork();\n        this.renderActivations();\n        // clean up\n        trainX1.dispose();\n        trainY1.dispose();\n        imageTensor.dispose();\n    }\n\n    computeActivations(input) {\n        const { nn } = this.trainingController;\n        if (nn.modelid === 'dense') {\n            const A1 = nn.model.layers[0].apply(input);\n            const A2 = nn.model.layers[1].apply(A1);\n            const A3 = nn.model.layers[2].apply(A2);\n            this.intermediateActivations = A2.dataSync().map(x => Math.abs(x) / 2);\n            this.currentProbabilities = A3.dataSync();\n            [this.currentTarget] = A3.argMax([-1]).dataSync();\n            A1.dispose();\n            A2.dispose();\n            A3.dispose();\n        } else {\n            const prediction = nn.model.predict(input);\n            this.currentProbabilities = prediction.dataSync();\n            [this.currentTarget] = prediction.argMax([-1]).dataSync();\n            prediction.dispose();\n        }\n    }\n\n    renderNetwork() {\n\n    }\n\n    clearActivations() {\n        this.drawCanvasCtx.clearRect(0, 0, this.drawCanvas.width, this.drawCanvas.height);\n    }\n\n    renderActivations() {\n        this.clearActivations();\n\n        if (this.trainDigitBuffer.active) {\n            const destOrigin = this.drawCanvas.width * 0.125;\n            const destSize = this.drawCanvas.width * 0.75;\n            // this.drawCanvasCtx.imageSmoothingEnabled = false; // no antialiasing\n            this.drawCanvasCtx.drawImage(this.trainDigitBuffer, 0, 0, 28, 28, destOrigin, destOrigin, destSize, destSize);\n            this.nnComponent.setClearTimeout();\n            this.nnComponent.setClearOnInput();\n        }\n\n        this.nnComponent.getBarChart().update(this.currentProbabilities, this.currentTarget);\n    }\n\n    async estimateAccuracy(model, testDataSize = 100) {\n        const { data }  = this.trainingController;\n        const accuracy = tf.tidy(() => {\n            const d = data.nextTestBatch(testDataSize);\n            const testXs = d.xs.reshape([testDataSize, 28, 28, 1]);\n            const testYs = d.labels;\n            return model.evaluate(testXs, testYs)[1].dataSync();\n        });\n\n        if (testDataSize < 1000 && accuracy > 0.9) {\n            // compute more exact accuracy if it is close to 100%\n            return await this.estimateAccuracy(model, 1000);\n        }\n\n        return (accuracy < 0.9) ?\n            Math.round(accuracy * 100) :\n            Math.round(accuracy * 1000) / 10;\n    }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar objectCreate = Object.create || objectCreatePolyfill\nvar objectKeys = Object.keys || objectKeysPolyfill\nvar bind = Function.prototype.bind || functionBindPolyfill\n\nfunction EventEmitter() {\n  if (!this._events || !Object.prototype.hasOwnProperty.call(this, '_events')) {\n    this._events = objectCreate(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nvar hasDefineProperty;\ntry {\n  var o = {};\n  if (Object.defineProperty) Object.defineProperty(o, 'x', { value: 0 });\n  hasDefineProperty = o.x === 0;\n} catch (err) { hasDefineProperty = false }\nif (hasDefineProperty) {\n  Object.defineProperty(EventEmitter, 'defaultMaxListeners', {\n    enumerable: true,\n    get: function() {\n      return defaultMaxListeners;\n    },\n    set: function(arg) {\n      // check whether the input is a positive number (whose value is zero or\n      // greater and not a NaN).\n      if (typeof arg !== 'number' || arg < 0 || arg !== arg)\n        throw new TypeError('\"defaultMaxListeners\" must be a positive number');\n      defaultMaxListeners = arg;\n    }\n  });\n} else {\n  EventEmitter.defaultMaxListeners = defaultMaxListeners;\n}\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || isNaN(n))\n    throw new TypeError('\"n\" argument must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\n// These standalone emit* functions are used to optimize calling of event\n// handlers for fast cases because emit() itself often has a variable number of\n// arguments and can be deoptimized because of that. These functions always have\n// the same number of arguments and thus do not get deoptimized, so the code\n// inside them can execute faster.\nfunction emitNone(handler, isFn, self) {\n  if (isFn)\n    handler.call(self);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self);\n  }\n}\nfunction emitOne(handler, isFn, self, arg1) {\n  if (isFn)\n    handler.call(self, arg1);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1);\n  }\n}\nfunction emitTwo(handler, isFn, self, arg1, arg2) {\n  if (isFn)\n    handler.call(self, arg1, arg2);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2);\n  }\n}\nfunction emitThree(handler, isFn, self, arg1, arg2, arg3) {\n  if (isFn)\n    handler.call(self, arg1, arg2, arg3);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2, arg3);\n  }\n}\n\nfunction emitMany(handler, isFn, self, args) {\n  if (isFn)\n    handler.apply(self, args);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].apply(self, args);\n  }\n}\n\nEventEmitter.prototype.emit = function emit(type) {\n  var er, handler, len, args, i, events;\n  var doError = (type === 'error');\n\n  events = this._events;\n  if (events)\n    doError = (doError && events.error == null);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    if (arguments.length > 1)\n      er = arguments[1];\n    if (er instanceof Error) {\n      throw er; // Unhandled 'error' event\n    } else {\n      // At least give some kind of context to the user\n      var err = new Error('Unhandled \"error\" event. (' + er + ')');\n      err.context = er;\n      throw err;\n    }\n    return false;\n  }\n\n  handler = events[type];\n\n  if (!handler)\n    return false;\n\n  var isFn = typeof handler === 'function';\n  len = arguments.length;\n  switch (len) {\n      // fast cases\n    case 1:\n      emitNone(handler, isFn, this);\n      break;\n    case 2:\n      emitOne(handler, isFn, this, arguments[1]);\n      break;\n    case 3:\n      emitTwo(handler, isFn, this, arguments[1], arguments[2]);\n      break;\n    case 4:\n      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);\n      break;\n      // slower\n    default:\n      args = new Array(len - 1);\n      for (i = 1; i < len; i++)\n        args[i - 1] = arguments[i];\n      emitMany(handler, isFn, this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n\n  events = target._events;\n  if (!events) {\n    events = target._events = objectCreate(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener) {\n      target.emit('newListener', type,\n          listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (!existing) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n          prepend ? [listener, existing] : [existing, listener];\n    } else {\n      // If we've already got an array, just append.\n      if (prepend) {\n        existing.unshift(listener);\n      } else {\n        existing.push(listener);\n      }\n    }\n\n    // Check for listener leak\n    if (!existing.warned) {\n      m = $getMaxListeners(target);\n      if (m && m > 0 && existing.length > m) {\n        existing.warned = true;\n        var w = new Error('Possible EventEmitter memory leak detected. ' +\n            existing.length + ' \"' + String(type) + '\" listeners ' +\n            'added. Use emitter.setMaxListeners() to ' +\n            'increase limit.');\n        w.name = 'MaxListenersExceededWarning';\n        w.emitter = target;\n        w.type = type;\n        w.count = existing.length;\n        if (typeof console === 'object' && console.warn) {\n          console.warn('%s: %s', w.name, w.message);\n        }\n      }\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    switch (arguments.length) {\n      case 0:\n        return this.listener.call(this.target);\n      case 1:\n        return this.listener.call(this.target, arguments[0]);\n      case 2:\n        return this.listener.call(this.target, arguments[0], arguments[1]);\n      case 3:\n        return this.listener.call(this.target, arguments[0], arguments[1],\n            arguments[2]);\n      default:\n        var args = new Array(arguments.length);\n        for (var i = 0; i < args.length; ++i)\n          args[i] = arguments[i];\n        this.listener.apply(this.target, args);\n    }\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = bind.call(onceWrapper, state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      list = events[type];\n      if (!list)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = objectCreate(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else\n          spliceOne(list, position);\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (!events.removeListener) {\n        if (arguments.length === 0) {\n          this._events = objectCreate(null);\n          this._eventsCount = 0;\n        } else if (events[type]) {\n          if (--this._eventsCount === 0)\n            this._events = objectCreate(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = objectKeys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = objectCreate(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (!events)\n    return [];\n\n  var evlistener = events[type];\n  if (!evlistener)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];\n};\n\n// About 1.5x faster than the two-arg version of Array#splice().\nfunction spliceOne(list, index) {\n  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)\n    list[i] = list[k];\n  list.pop();\n}\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction objectCreatePolyfill(proto) {\n  var F = function() {};\n  F.prototype = proto;\n  return new F;\n}\nfunction objectKeysPolyfill(obj) {\n  var keys = [];\n  for (var k in obj) if (Object.prototype.hasOwnProperty.call(obj, k)) {\n    keys.push(k);\n  }\n  return k;\n}\nfunction functionBindPolyfill(context) {\n  var fn = this;\n  return function () {\n    return fn.apply(context, arguments);\n  };\n}\n"]}